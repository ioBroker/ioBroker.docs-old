<!DOCTYPE html>
<!--[if IE 8 ]>
	<html class="no-js ie8" lang="de-DE">
<![endif]-->
<!--[if IE 9 ]>
	<html class="no-js ie9" lang="de-DE">
<![endif]-->
<!--[if gt IE 9]><!-->
<html lang="de-DE"><!--<![endif]-->
	<head>
				<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"> 

		<link rel="profile" href="http://gmpg.org/xfn/11">
		<link rel="pingback" href="http://www.iobroker.net/docu/xmlrpc.php">
		
		<title>MQTT &#8211; ioBroker</title>
<link rel='dns-prefetch' href='//netdna.bootstrapcdn.com'>
<link rel='dns-prefetch' href='//s.w.org'>
<link rel="alternate" type="application/rss+xml" title="ioBroker &raquo; Feed" href="index.rss?feed=rss2&#038;lang=de">
<link rel="alternate" type="application/rss+xml" title="ioBroker &raquo; Kommentar-Feed" href="index-1.rss?feed=comments-rss2&#038;lang=de">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.iobroker.net\/docu\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.5"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css' href='wp-content\plugins\crayon-syntax-highlighter\css\min\crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all'>
<link rel='stylesheet' id='crayon-theme-classic-css' href='wp-content\plugins\crayon-syntax-highlighter\themes\classic\classic.css?ver=_2.7.2_beta' type='text/css' media='all'>
<link rel='stylesheet' id='crayon-font-monaco-css' href='wp-content\plugins\crayon-syntax-highlighter\fonts\monaco.css?ver=_2.7.2_beta' type='text/css' media='all'>
<link rel='stylesheet' id='contact-form-7-css' href='wp-content\plugins\contact-form-7\includes\css\styles.css?ver=4.9.2' type='text/css' media='all'>
<link rel='stylesheet' id='cookie-law-info-css' href='wp-content\plugins\cookie-law-info\public\css\cookie-law-info-public.css?ver=1.7.6' type='text/css' media='all'>
<link rel='stylesheet' id='cookie-law-info-gdpr-css' href='wp-content\plugins\cookie-law-info\public\css\cookie-law-info-gdpr.css?ver=1.7.6' type='text/css' media='all'>
<link rel='stylesheet' id='dedo-css-css' href='wp-content\plugins\delightful-downloads\assets\css\delightful-downloads.min.css?ver=1.6.6' type='text/css' media='all'>
<link rel='stylesheet' id='mbpro-font-awesome-css' href='wp-content\plugins\maxbuttons\assets\libraries\font-awesome\css\font-awesome.min.css?ver=6.28' type='text/css' media='all'>
<link rel='stylesheet' id='page-list-style-css' href='wp-content\plugins\page-list\css\page-list.css?ver=5.1' type='text/css' media='all'>
<link rel='stylesheet' id='pc_google_analytics-frontend-css' href='http://www.iobroker.net/docu/wp-content/plugins/pc-google-analytics/assets/css/frontend.css?ver=1.0.0' type='text/css' media='all'>
<link rel='stylesheet' id='font-awesome-css' href='//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css' type='text/css' media='screen'>
<link rel='stylesheet' id='toc-screen-css' href='wp-content\plugins\table-of-contents-plus\screen.min.css?ver=1509' type='text/css' media='all'>
<link rel='stylesheet' id='parent-style-css' href='wp-content\themes\responsive-mobile\style.css?ver=4.7.5' type='text/css' media='all'>
<link rel='stylesheet' id='responsive-mobile-style-css' href='wp-content\themes\responsive-mobile\css\style.css?ver=1.8' type='text/css' media='all'>
<link rel='stylesheet' id='responsive-mobile-child-style-css' href='wp-content\themes\responsive-mobile_child\style.css?ver=1.0' type='text/css' media='all'>
<link rel='stylesheet' id='recent-posts-widget-with-thumbnails-public-style-css' href='wp-content\plugins\recent-posts-widget-with-thumbnails\public.css?ver=6.5.0' type='text/css' media='all'>
<link rel='stylesheet' id='cleverness_todo_list_frontend-css' href='wp-content\plugins\cleverness-to-do-list\css\cleverness-to-do-list-frontend.css?ver=3.4.2' type='text/css' media='all'>
<link rel='stylesheet' id='jquery.ui.theme-css' href='wp-content\plugins\cleverness-to-do-list\css\jquery-ui-fresh.css?ver=3.4.2' type='text/css' media='all'>
<link rel='stylesheet' id='tablepress-default-css' href='wp-content\tablepress-combined.min.css?ver=128' type='text/css' media='all'>
<link rel='stylesheet' id='bootstrap-css' href='wp-content\themes\responsive-mobile\libraries\bootstrap\css\bootstrap.min.css?ver=4.7.5' type='text/css' media='all'>
<script type='text/javascript' src='wp-includes\js\jquery\jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='wp-includes\js\jquery\jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/www.iobroker.net\/docu\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Dr\u00fccken Sie %s zum Kopieren, %s zum Einf\u00fcgen","minimize":"Klicken um Code aufzuklappen"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content\plugins\crayon-syntax-highlighter\js\min\crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var Cli_Data = {"nn_cookie_ids":[],"cookielist":[]};
var log_object = {"ajax_url":"http:\/\/www.iobroker.net\/docu\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content\plugins\cookie-law-info\public\js\cookie-law-info-public.js?ver=1.7.6'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var mb_ajax = {"ajaxurl":"http:\/\/www.iobroker.net\/docu\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content\plugins\maxbuttons\js\min\front.js?ver=6.28'></script>
<script type='text/javascript' src='wp-content\plugins\pc-google-analytics\assets\js\frontend.min.js?ver=1.0.0'></script>
<script type='text/javascript' src='wp-content\themes\responsive-mobile\libraries\bootstrap\js\bootstrap.min.js?ver=4.7.5'></script>
<link rel='https://api.w.org/' href='index.json?rest_route=/'>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.xml?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes\wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.7.5">
<link rel="canonical" href="index-378.htm?page_id=3790&#038;lang=de">
<link rel='shortlink' href='http://www.iobroker.net/docu/?p=3790'>
<link rel="alternate" type="application/json+oembed" href="index-353.json?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Fwww.iobroker.net%2Fdocu%2F%3Fpage_id%3D3790%26lang%3Dde">
<link rel="alternate" type="text/xml+oembed" href="index-352.xml?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Fwww.iobroker.net%2Fdocu%2F%3Fpage_id%3D3790%26lang%3Dde&#038;format=xml">
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-86900958-1', 'auto');
		ga('send', 'pageview');
		
		</script>

<style>
.scroll-back-to-top-wrapper {
    position: fixed;
	opacity: 0;
	visibility: hidden;
	overflow: hidden;
	text-align: center;
	z-index: 99999999;
    background-color: #777777;
	color: #eeeeee;
	width: 50px;
	height: 48px;
	line-height: 48px;
	right: 30px;
	bottom: 30px;
	padding-top: 2px;
	border-top-left-radius: 10px;
	border-top-right-radius: 10px;
	border-bottom-right-radius: 10px;
	border-bottom-left-radius: 10px;
	-webkit-transition: all 0.5s ease-in-out;
	-moz-transition: all 0.5s ease-in-out;
	-ms-transition: all 0.5s ease-in-out;
	-o-transition: all 0.5s ease-in-out;
	transition: all 0.5s ease-in-out;
}
.scroll-back-to-top-wrapper:hover {
	background-color: #888888;
  color: #eeeeee;
}
.scroll-back-to-top-wrapper.show {
    visibility:visible;
    cursor:pointer;
	opacity: 1.0;
}
.scroll-back-to-top-wrapper i.fa {
	line-height: inherit;
}
.scroll-back-to-top-wrapper .fa-lg {
	vertical-align: 0;
}
</style><!-- Analytics by WP-Statistics v12.6 - https://wp-statistics.com/ -->
<link rel="alternate" href="index-378.htm?page_id=3790&#038;lang=de" hreflang="de">
<link rel="alternate" href="index-88.htm?page_id=6435&#038;lang=en" hreflang="en">
<link rel="alternate" href="index-141.htm?page_id=4643&#038;lang=ru" hreflang="ru">
		<script type="text/javascript">
			var cli_flush_cache=1;
		</script>
				<style type="text/css" id="wp-custom-css">
			/*
You can add your own CSS here.

Click the help icon above to learn more.
*/
.site-content .content-area{
	/*background: #6592c9;*/
}		</style>
	<style type="text/css">
.paypal-donations { text-align: center !important }
</style>
	</head>

<body class="page-template page-template-page-templates page-template-content-sidebar-page_adaptermenue page-template-page-templatescontent-sidebar-page_adaptermenue-php page page-id-3790 page-child parent-pageid-7529 group-blog content-sidebar-page_adaptermenue" itemscope="itemscope" itemtype="http://schema.org/WebPage">
<div id="container" class="site">
	<a class="skip-link screen-reader-text" href="#content">Springe zum Inhalt</a>
	<a class="skip-link screen-reader-text" href="#main-navigation">Zum Hauptmenü springen</a>
	<div id="top-menu-container" class="container-full-width">
		<nav id="top-menu" class="container" itemscope="" itemtype="http://schema.org/SiteNavigationElement">
			<ul id="menu-2016_top_menue" class="top-menu"><li id="menu-item-2203-de" class="lang-item lang-item-4 lang-item-de lang-item-first current-lang menu-item menu-item-type-custom menu-item-object-custom menu-item-2203-de"><a href="index-378.htm?page_id=3790&#038;lang=de" hreflang="de-DE" lang="de-DE">Deutsch</a></li>
<li id="menu-item-2203-en" class="lang-item lang-item-7 lang-item-en menu-item menu-item-type-custom menu-item-object-custom menu-item-2203-en"><a href="index-88.htm?page_id=6435&#038;lang=en" hreflang="en-GB" lang="en-GB">English</a></li>
<li id="menu-item-2203-ru" class="lang-item lang-item-20 lang-item-ru menu-item menu-item-type-custom menu-item-object-custom menu-item-2203-ru"><a href="index-141.htm?page_id=4643&#038;lang=ru" hreflang="ru-RU" lang="ru-RU">Русский</a></li>
</ul>		</nav>
	</div><!-- top menu container -->
        <div id="header_section">
	<header id="header" class="container-full-width site-header" role="banner" itemscope="itemscope" itemtype="http://schema.org/WPHeader">
				<div class="container">
			<div class="header-row">
				<div id="site-branding">
							<div id="logo">
			<a href="index.htm?lang=de" rel="home" itemprop="url" title="ioBroker">
				<img src="wp-content\uploads\ioBroker_logo_lang-e1456684383484.png" alt="ioBroker" itemprop="image">
			</a>
		</div>
					</div>
				<div id="secondary-header">
					
	<div id="top-widget" class="top-widget" role="complementary" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
		
			<div id="search-2" class="responsive-mobile-top-widget widget_search"><form role="search" method="get" class="search-form" action="http://www.iobroker.net/docu/">
				<label>
					<span class="screen-reader-text">Suche nach:</span>
					<input type="search" class="search-field" placeholder="Suche&#160;&hellip;" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="Suche">
			<input type="hidden" name="lang" value="de"></form></div>
			</div><!-- end of #top-widget -->
				</div>
			</div>
		</div>

			</header><!-- #header -->

	<div id="main-menu-container" class="container-full-width">
		<div id="main-menu" class="container">
			<nav id="main-navigation" class="site-navigation" role="navigation" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
				<div id="mobile-current-item">Menü</div>
				<button id="mobile-nav-button"><span class="accessibile-label">Mobile-Menü ein-/ausschalten</span></button>
				<div class="main-nav"><ul id="menu-2016_kopfzeile_de" class="menu"><li id="menu-item-2204" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2204"><a href="..\index.htm">Startseite</a></li>
<li id="menu-item-7199" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7199"><a href="http://www.iobrokers.de/">Shop</a></li>
<li id="menu-item-2278" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2278"><a href="index-3.htm?page_id=2258&#038;lang=de">Aktuelles</a></li>
<li id="menu-item-2626" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2626"><a href="index-4.htm?page_id=2375&#038;lang=de">Einleitung</a>
<ul class="sub-menu">
	<li id="menu-item-6381" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6381"><a href="index-4.htm?page_id=2375&#038;lang=de">für alle</a></li>
	<li id="menu-item-6380" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-6380"><a href="index-5.htm?page_id=6317&#038;lang=de">für Einsteiger</a>
	<ul class="sub-menu">
		<li id="menu-item-6451" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6451"><a href="index-6.htm?page_id=6335&#038;lang=de">Server aufsetzen</a></li>
		<li id="menu-item-6450" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6450"><a href="index-7.htm?page_id=5063&#038;lang=de">erste Adapter</a></li>
		<li id="menu-item-6449" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6449"><a href="index-8.htm?page_id=6365&#038;lang=de">erste Visualisierung</a></li>
		<li id="menu-item-6826" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6826"><a href="index-9.htm?page_id=6548&#038;lang=de">Daten loggen</a></li>
		<li id="menu-item-6825" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6825"><a href="index-10.htm?page_id=6562&#038;lang=de">erster Chart</a></li>
	</ul>
</li>
	<li id="menu-item-2289" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2289"><a href="index-11.htm?page_id=2281&#038;lang=de">für Entwickler</a></li>
</ul>
</li>
<li id="menu-item-2290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2290"><a href="index-12.htm?page_id=2279&#038;lang=de">Installation / Start</a>
<ul class="sub-menu">
	<li id="menu-item-2395" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2395"><a href="index-13.htm?page_id=2387&#038;lang=de">Videos</a></li>
	<li id="menu-item-3336" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3336"><a href="index-14.htm?page_id=3334&#038;lang=de">Plattformen / Betriebssystem</a>
	<ul class="sub-menu">
		<li id="menu-item-8383" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8383"><a href="index-15.htm?page_id=8323&#038;lang=de">Linux Schnellstart (auch für Raspberry Pi 2/3)</a></li>
		<li id="menu-item-8382" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8382"><a href="index-16.htm?page_id=8327&#038;lang=de">Schnellstart für Raspberry Pi 1</a></li>
		<li id="menu-item-8429" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8429"><a href="index-17.htm?page_id=8390&#038;lang=de">Windows</a></li>
		<li id="menu-item-2300" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2300"><a href="index-18.htm?page_id=2293&#038;lang=de">OS X</a></li>
		<li id="menu-item-3337" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3337"><a href="index-19.htm?page_id=2563&#038;lang=de">Downloads für die Installation</a></li>
		<li id="menu-item-5362" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5362"><a href="index-20.htm?page_id=5358&#038;lang=de">Einrichtung und Installation von ioBroker in VirtualBox</a></li>
		<li id="menu-item-6767" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6767"><a href="index-21.htm?page_id=6764&#038;lang=de">ioBroker mit Cloud auf QNAP-453a</a></li>
	</ul>
</li>
	<li id="menu-item-2358" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2358"><a href="index-22.htm?page_id=2354&#038;lang=de">Erster Start von ioBroker</a></li>
	<li id="menu-item-8530" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8530"><a href="index-23.htm?page_id=8511&#038;lang=de">Grundlagen zur Verwendung von Adaptern</a></li>
	<li id="menu-item-3070" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3070"><a href="index-24.htm?page_id=3068&#038;lang=de">Multihost Modus</a></li>
	<li id="menu-item-5890" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5890"><a href="index-25.htm?page_id=5859&#038;lang=de">Alexa mit ioBroker (Schnellstart)</a></li>
	<li id="menu-item-3964" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3964"><a href="index-26.htm?page_id=3928&#038;lang=de">ioBroker läuft nicht mehr</a></li>
	<li id="menu-item-5532" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5532"><a href="index-27.htm?page_id=5510&#038;lang=de">Wie das Packet serialport oder ähnlich zu installieren</a></li>
</ul>
</li>
<li id="menu-item-2248" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-has-children menu-item-2248"><a href="index-28.htm?page_id=2236&#038;lang=de">Adapter</a>
<ul class="sub-menu">
	<li id="menu-item-2249" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2249"><a href="index-29.htm?page_id=2238&#038;lang=de">Allgemein</a></li>
	<li id="menu-item-2429" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2429"><a href="index-30.htm?page_id=2407&#038;lang=de">Aufbewahrung</a>
	<ul class="sub-menu">
		<li id="menu-item-6988" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6988"><a href="index-31.htm?page_id=5197&#038;lang=de">Howto – MariaDB auf der Synology DiskStation als Datenbank für Flot</a></li>
	</ul>
</li>
	<li id="menu-item-2430" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2430"><a href="index-32.htm?page_id=2405&#038;lang=de">Hardware</a></li>
	<li id="menu-item-2425" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2425"><a href="index-33.htm?page_id=2417&#038;lang=de">Kommunikation</a></li>
	<li id="menu-item-2424" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2424"><a href="index-34.htm?page_id=2419&#038;lang=de">Medien</a></li>
	<li id="menu-item-2426" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2426"><a href="index-35.htm?page_id=2415&#038;lang=de">Skripte und Logik</a></li>
	<li id="menu-item-2427" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2427"><a href="index-36.htm?page_id=2412&#038;lang=de">ioBroker.vis</a>
	<ul class="sub-menu">
		<li id="menu-item-5035" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5035"><a href="index-37.htm?page_id=5026&#038;lang=de">ioBroker.vis App</a></li>
	</ul>
</li>
	<li id="menu-item-2431" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2431"><a href="index-38.htm?page_id=2403&#038;lang=de">Visualisierung</a></li>
	<li id="menu-item-2423" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2423"><a href="index-39.htm?page_id=2421&#038;lang=de">Wartung</a></li>
	<li id="menu-item-2432" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2432"><a href="index-40.htm?page_id=2401&#038;lang=de">Wetter</a></li>
	<li id="menu-item-2428" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2428"><a href="index-41.htm?page_id=2410&#038;lang=de">Zeitplanung</a></li>
</ul>
</li>
<li id="menu-item-2805" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2805"><a href="index-42.htm?page_id=2786&#038;lang=de">Scripte</a>
<ul class="sub-menu">
	<li id="menu-item-5401" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5401"><a href="index-43.htm?page_id=5385&#038;lang=de">Einführung Programmieren mit Javascript</a></li>
	<li id="menu-item-3757" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3757"><a href="index-44.htm?page_id=3526&#038;lang=de">Counter</a></li>
	<li id="menu-item-3758" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3758"><a href="index-45.htm?page_id=3585&#038;lang=de">Heizung / Lüftung</a></li>
	<li id="menu-item-3759" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3759"><a href="index-46.htm?page_id=3587&#038;lang=de">Info / Status</a></li>
	<li id="menu-item-3755" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3755"><a href="index-47.htm?page_id=3589&#038;lang=de">Mediensteuerung</a></li>
	<li id="menu-item-3754" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3754"><a href="index-48.htm?page_id=3593&#038;lang=de">Steuern / Regeln</a></li>
	<li id="menu-item-3756" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3756"><a href="index-49.htm?page_id=3591&#038;lang=de">Zeitsteuerung</a></li>
</ul>
</li>
<li id="menu-item-2288" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2288"><a href="index-50.htm?page_id=2283&#038;lang=de">Downloads</a>
<ul class="sub-menu">
	<li id="menu-item-2806" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2806"><a href="index-19.htm?page_id=2563&#038;lang=de">Downloads für die Installation</a></li>
	<li id="menu-item-5146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5146"><a href="index-42.htm?page_id=2786&#038;lang=de">Scripte</a></li>
</ul>
</li>
<li id="menu-item-2287" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2287"><a href="index-51.htm?page_id=2285&#038;lang=de">Forum / Support</a>
<ul class="sub-menu">
	<li id="menu-item-2379" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2379"><a href="http://forum.iobroker.net">Forum</a></li>
	<li id="menu-item-7324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7324"><a href="index-52.htm?page_id=7322&#038;lang=de">Glossar</a></li>
	<li id="menu-item-2396" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2396"><a href="index-53.htm?page_id=2380&#038;lang=de">FAQ</a></li>
	<li id="menu-item-8440" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8440"><a href="index-54.htm?page_id=8438&#038;lang=de">Troubleshooting (in Arbeit)</a></li>
	<li id="menu-item-2394" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2394"><a href="index-55.htm?page_id=2392&#038;lang=de">Tipps und Tricks</a></li>
</ul>
</li>
</ul></div>			</nav><!-- #site-navigation -->
		</div><!-- #main-menu -->
	</div><!-- #main-menu-container -->
	<div id="sub-menu-container" class="container-full-width">
		<div id="sub-menu" class="container">
			<nav id="sub-navigation" class="site-navigation" role="navigation" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
						</nav><!-- #site-navigation -->
		</div><!-- #sub-menu -->
	</div><!-- #sub-menu-container -->
        </div>
	<div id="wrapper" class="site-content container-full-width">

	<div id="content" class="content-area">
		<main id="main" class="site-main content-sidebar" role="main">

			
				<div class="breadcrumb-list" xmlns:v="http://rdf.data-vocabulary.org/#"><span class="breadcrumb" typeof="v:Breadcrumb"><a rel="v:url" property="v:title" href="index.htm?lang=de">Home</a></span> <span class="chevron">&#8250;</span> <span class="breadcrumb" typeof="v:Breadcrumb"><a rel="v:url" property="v:title" href="index-163.htm?page_id=2364&lang=de">Deutsch</a></span> <span class="chevron">&#8250;</span> <span class="breadcrumb" typeof="v:Breadcrumb"><a rel="v:url" property="v:title" href="index-28.htm?page_id=2236&lang=de">Adapter</a></span> <span class="chevron">&#8250;</span> <span class="breadcrumb" typeof="v:Breadcrumb"><a rel="v:url" property="v:title" href="http://www.iobroker.net/docu/?page_id=7529&lang=de">Protokolle</a></span> <span class="chevron">&#8250;</span> <span class="breadcrumb-current">MQTT</span></div>
								
					
<article id="post-3790" class="post-3790 page type-page status-publish hentry">
		
	
<header class="entry-header">
	
	</header><!-- .entry-header -->

	<div class="post-entry">
		<p><a href="https://github.com/ioBroker/ioBroker.mqtt"><img class="alignright" style="border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" width="149" height="149"></a><br>
<img class="alignnone" src="http://download.iobroker.net/img/logo-mqtt.png" width="64" height="64"></p>
<h1><span id="Was_ist_MQTT">Was ist MQTT</span></h1>
<p style="text-align: justify;"><a href="http://mqtt.org/">MQTT</a> (<em>Message Queue Telemetry Transport</em>) ist ein schlankes Protokoll für die Kommunikation zwischen verschiedenen Geräten (M2M &#8211; machine-to-machine). Es benutzt das publisher-subscriber Modell um Nachrichten über das TCP/IP Protokoll zu senden. Die zentrale Stelle des Protokolls ist der MQTT-Server oder <em>Broker</em> der Zugriff auf die Clients, die entweder als <em>publisher</em> (sendet Daten) und den <em>subscriber</em> (abonniert Daten) besitzt. Dieses Protokoll ist sehr simpel: ein kurzer Header ohne Integrität (deshalb setzt die Übermittlung auf TCP auf), legt der Struktur keinerlei Beschränkungen beim Code oder einem Datenbankschema auf. Die einzige Bedingung ist dass jedes Datenpaket eine Information zur Identifikation beinhalten muss. Diese Identifikationsinformation heißt <em>Topic Name</em>.</p>
<p style="text-align: justify;">Das MQTT Protokoll benötigt einen Datenbroker. Dieses ist die zentrale Idee dieser Technologie. Alle Geräte senden ihre Daten nur zu diesem Broker und erhalten ihre Informationen auch nur von ihm. Nach dem Empfang des Paketes sendet der Broker es zu allen Geräten in dem Netzwerk, die es abonniert haben. Wenn ein Gerät etwas von dem Broker möchte, muss er das entsprechende Topic abonnieren. Topics entstehen dynamisch bei Abonnement oder beim Empfang eines Paketes mit diesem Topic. Nach dem Abonnement eines Topics braucht man nichts mehr zu tun. Deswegen sind Topics sehr bequem um verschiedenen Beziehungen zu organisieren: one-to-many, many-to-one and many-to-many.</p>
<p><strong>Wichtig:</strong></p>
<ul>
<li>Die Geräte stellen selber die Kommunikation mit dem Broker her. Sie können hinter einer NAT liegen und  müssen keine feste IP besitzen,</li>
<li>Man kann den Traffic mit SSL absichern,</li>
<li>MQTT Broker ermöglichen es diese über ein Websocket Protokoll auf Port 80 zu erreichen,</li>
<li>Mehrere Broker können miteinander verbunden werden und abonnieren dann die Nachrichten gegenseitig.</li>
</ul>
<div id="toc_container" class="no_bullets"><ul class="toc_list"><li><a href="#Was_ist_MQTT"><span class="toc_number toc_depth_1">1</span> Was ist MQTT</a></li><li><a href="#Steckbrief"><span class="toc_number toc_depth_1">2</span> Steckbrief</a></li><li><a href="#Installation"><span class="toc_number toc_depth_1">3</span> Installation</a></li><li><a href="#Konfiguration"><span class="toc_number toc_depth_1">4</span> Konfiguration</a><ul><li><a href="#IoBroker_alsMQTT-Broker"><span class="toc_number toc_depth_2">4.1</span> IoBroker als MQTT-Broker</a><ul><li><a href="#Allgemeine_Einstellungen"><span class="toc_number toc_depth_3">4.1.1</span> Allgemeine Einstellungen</a></li><li><a href="#Verbindungseinstellungen"><span class="toc_number toc_depth_3">4.1.2</span> Verbindungseinstellungen</a></li><li><a href="#Authentication_Einstellungen"><span class="toc_number toc_depth_3">4.1.3</span> Authentication Einstellungen</a></li><li><a href="#MQTT_Einstellungen"><span class="toc_number toc_depth_3">4.1.4</span> MQTT Einstellungen</a></li></ul></li><li><a href="#IoBroker_working_as_MQTT-client"><span class="toc_number toc_depth_2">4.2</span> IoBroker working as MQTT-client</a><ul><li><a href="#Allgemeine_Einstellungen-2"><span class="toc_number toc_depth_3">4.2.1</span> Allgemeine Einstellungen</a></li><li><a href="#Verbindungseinstellungen-2"><span class="toc_number toc_depth_3">4.2.2</span> Verbindungseinstellungen</a></li><li><a href="#Authentication_settings"><span class="toc_number toc_depth_3">4.2.3</span> Authentication settings </a></li><li><a href="#MQTT_Einstellungen-2"><span class="toc_number toc_depth_3">4.2.4</span> MQTT Einstellungen</a></li></ul></li><li><a href="#Application_8211_MQTT_gateway_protocols_8211_ModBus_RTU"><span class="toc_number toc_depth_2">4.3</span> Application &#8211; MQTT gateway protocols &#8211; ModBus RTU</a></li><li><a href="#Application_8211_connecting_mobile_clients"><span class="toc_number toc_depth_2">4.4</span> Application &#8211; connecting mobile clients</a></li><li><a href="#Application_8211_working_with_cloud_servers"><span class="toc_number toc_depth_2">4.5</span> Application &#8211; working with cloud servers</a></li></ul></li></ul></div>

<h1><span id="Steckbrief">Steckbrief</span></h1>
<table width="100%">
<tbody>
<tr>
<td style="width: 675px; height: 20px;"><strong>Aktuelle Versionen<br>
</strong></td>
<td style="width: 675px; height: 20px;">stable: <a href="https://www.npmjs.com/package/iobroker.mqtt"><img class="alignnone" src="http://img.shields.io/npm/v/iobroker.mqtt.svg" width="80" height="20"></a>    latest: <a href="https://www.npmjs.com/package/iobroker.mqtt"><img class="alignnone" src="http://img.shields.io/npm/v/iobroker.mqtt.svg" width="80" height="20"></a></td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"></td>
<td style="width: 675px; height: 20px;"></td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>Voraussetzungen</strong></td>
<td style="width: 675px; height: 20px;">/</td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>Entwickler</strong></td>
<td style="width: 675px; height: 20px;">Bluefox</td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>Keywords<br>
</strong></td>
<td style="width: 675px; height: 20px;">data transmission, sensors, cloud, publish/subscribe</td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>Github</strong></td>
<td style="width: 675px; height: 20px;"><img class="alignnone wp-image-2342 size-full" src="wp-content\uploads\icon_link-1.png" alt="icon_link" width="16" height="16"> <a href="https://github.com/ioBroker/ioBroker.mqtt" target="_blank" rel="noopener noreferrer">Link</a></td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>Platform</strong></td>
<td style="width: 675px; height: 20px;">Javascript/Node.js</td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>Lizenz</strong></td>
<td style="width: 675px; height: 20px;">MIT</td>
</tr>
<tr>
<td style="width: 675px; height: 20px;"><strong>letzte Änderung der Doku</strong></td>
<td style="width: 675px; height: 20px;">19.11.2017</td>
</tr>
</tbody>
</table>
<h2></h2>
<h1><span id="Installation"><span id="i-3">Installation</span></span></h1>
<p>Die Installation findet im Admin im Reiter <em><strong>Adapter</strong></em> statt. In der Gruppe Kommunikation befindet sich eine Zeile <strong><em>MQTT Adapter</em></strong>, dort wird über das (+)-Icon ganz rechts eine neue Instanz angelegt.</p>
<p><a href="wp-content\uploads\1.png"><img class="aligncenter wp-image-6600 size-large" src="wp-content\uploads\1-1024x342-1.png" alt="" width="750" height="250" srcset="wp-content\uploads\1-1024x342.png 1024w, wp-content\uploads\1-150x50.png 150w, wp-content\uploads\1-300x100.png 300w, wp-content\uploads\1-100x33.png 100w, wp-content\uploads\1-200x67.png 200w, wp-content\uploads\1-450x150.png 450w, wp-content\uploads\1-600x201.png 600w, wp-content\uploads\1-900x301.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>Ein pop-up Fenster erscheint mit den Installationsinformationen und schließt nach der Installation eigenständig.</p>
<p><a href="wp-content\uploads\2.png"><img class="aligncenter wp-image-6602 " src="wp-content\uploads\2-300x153-1.png" alt="" width="600" height="306" srcset="wp-content\uploads\2-300x153.png 300w, wp-content\uploads\2-150x77.png 150w, wp-content\uploads\2-100x51.png 100w, wp-content\uploads\2-200x102.png 200w, wp-content\uploads\2-450x230.png 450w, wp-content\uploads\2-600x307.png 600w, wp-content\uploads\2-900x460.png 900w, wp-content\uploads\2.png 929w" sizes="(max-width: 600px) 100vw, 600px"></a></p>
<p>Wenn alles klappt befindet sich anschließend unter dem Reiter <em><strong>Instanzen</strong></em> die neu installierte <strong>mqtt.0</strong> Instanz.</p>
<p><a href="wp-content\uploads\3.png"><img class="aligncenter wp-image-6603 " src="wp-content\uploads\3-300x156-1.png" alt="" width="600" height="312" srcset="wp-content\uploads\3-300x156.png 300w, wp-content\uploads\3-150x78.png 150w, wp-content\uploads\3-100x52.png 100w, wp-content\uploads\3-200x104.png 200w, wp-content\uploads\3-450x234.png 450w, wp-content\uploads\3-600x311.png 600w, wp-content\uploads\3.png 836w" sizes="(max-width: 600px) 100vw, 600px"></a></p>
<p>&nbsp;</p>
<h1><span id="Konfiguration"><span id="i-3">Konfiguration</span></span></h1>
<p>Wie bereits oben gesagt, besteht ein MQTT-System aus einem Broker und Clients.  Der ioBroker Server kann als Broker oder als Client arbeiten.  Entsprechend des gewünschten Modus wird der Typ auf <em><strong>server/broker</strong></em> oder <strong><em>Client/subscriber</em></strong> eingestellt. Hier sollte die Einstellung gut überlegt werden.</p>
<h3></h3>
<h2><span id="IoBroker_alsMQTT-Broker">IoBroker als MQTT-Broker</span></h2>
<p>Die Grundeinstellungen um den Adapter als Server/Broker zu verwenden sind in der Abbildung gezeigt:</p>
<p><img class="wp-image-6789 aligncenter" src="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491.jpg" alt="" width="600" height="675" srcset="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-1.jpg 805w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-133x150.jpg 133w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-267x300.jpg 267w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-100x113.jpg 100w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-150x169.jpg 150w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-200x225.jpg 200w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-300x338.jpg 300w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-450x506.jpg 450w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server-e1510689666491-600x675.jpg 600w" sizes="(max-width: 600px) 100vw, 600px"></p>
<h3><span id="Allgemeine_Einstellungen">Allgemeine Einstellungen</span></h3>
<ul>
<li><strong>Typ</strong> &#8211; Entsprechend der gewünschten Verwendung wird der Typ auf <em><strong>server/broker</strong></em> oder <strong><em>Client/subscriber</em></strong> eingestellt</li>
<li><strong>Use WebSockets</strong> &#8211; Wenn man Websockets für die Verbindung benötigt, muss diese Checkbox aktiviert werden. Dann läuft der TCP-Server parallel zum WebSocket Server,</li>
<li><strong>Port</strong> &#8211; Der Port um mit TCP zu verbinden (default: 1883),  ein WebSocket Server (siehe oben) läuft einen Port höher (default: 1884),</li>
</ul>
<p>&nbsp;</p>
<h3><span id="Verbindungseinstellungen">Verbindungseinstellungen</span></h3>
<ul>
<li><strong>SSL</strong> &#8211; Diese Option wird benötigt um den gesamten Datenverkehr zu verschlüsseln (TCP und WebSocket), deshalb muss man in den jetzt zur Verfügung stehenden Feldern die zu verwendenden Zertifikate angeben. In den Pulldowns kann man diese aus den in den Systemeinstellungen angelegten Zertifikaten auswählen,</li>
</ul>
<p style="padding-left: 30px;"><a href="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH.jpg"><img class="aligncenter wp-image-6790 size-full" src="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH-1.jpg" alt="" width="489" height="178" srcset="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH.jpg 489w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH-150x55.jpg 150w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH-300x109.jpg 300w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH-100x36.jpg 100w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH-200x73.jpg 200w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Server_SSH-450x164.jpg 450w" sizes="(max-width: 489px) 100vw, 489px"></a></p>
<h3><span id="Authentication_Einstellungen">Authentication Einstellungen</span></h3>
<ul>
<li><strong>Username</strong> und <strong>Passwort</strong> &#8211; Wenn gewünscht kann hier ein Username und ein Passwort vergeben werden. Dies muss auf jeden Fall mit SSH Verschlüsselung benutzt werden, damit Passworte nicht unverschlüsselt übertragen werden.</li>
</ul>
<p>&nbsp;</p>
<h3><span id="MQTT_Einstellungen">MQTT Einstellungen</span></h3>
<ul>
<li><strong>Maske für Bekanntgeben von eigenen States</strong> &#8211; Diese Maske (oder mehrere durch Komma getrennt)dienen dazu die Variablen zu filtern, die an den Client geschickt werden sollen. Man kann Sonderzeichen angeben um eine Gruppe von Nachrichten zu definieren (z.B.  <code>memRSS, mqtt.0</code> &#8211; sendet alle Variablen zum memory status aller Adapter und alle variablen der <strong>mqtt.0 Adapter </strong>Instanz),</li>
<li><strong>Publish nur bei Änderungen</strong> &#8211; sending data to the client will be made only in case of change of a variable (if the state simply update &#8211; the value is not changed, the customer message will not be sent) from the client will be accepted any message, even if the value has not changed,</li>
<li><strong>To give private values at startup</strong> &#8211; for each successful client connection will be transferred to all known states (defined by the mask state) – in order to tell the client about the current state of the ioBroker,</li>
<li><strong>Post status subscribes</strong> &#8211; immediately after the subscription will be sent to the customer value of the variable on which it is signed (at the first start or restart the client will receive the values of variables on which it is signed, can be used to initialize variables),</li>
<li><strong>The prefix for all values</strong> &#8211; if the specified value, it will be added as a prefix to every sent topic, for example, if you specify iobroker/, then all topics sent along the following lines: <code>iobroker/mqtt/0/connected</code>,</li>
<li><strong>Output log for each change</strong> &#8211; in the log file will display debugging information for each change,</li>
<li><strong>To send not only commands, but also the state (ack=true)</strong> &#8211; if this option is not active, the client will only send variables/commands with ack=false, if the flag is set, then variables will be transferred regardless of the state of ack (false / true),</li>
<li><strong>The maximum length of the name of a topic</strong> &#8211; the maximum number of characters for the description of the topic, including service.</li>
</ul>
<p>As an example, consider the exchange of data between the client based on the <a href="https://www.arduino.cc/">arduino board</a> and the broker is an instance of mqtt.0 driver system ioBroker.</p>
<ul>
<li>&#8211; the client – the fee for developing <a href="https://www.arduino.cc/en/Main/ArduinoBoardUno">arduino UNO</a> + <a href="https://store.arduino.cc/product/A000072">ethernet shield</a> based on W5100 chip,</li>
<li>&#8211; to work with the ethernet board uses the standard <a href="https://www.arduino.cc/en/Reference/Ethernet">library </a>for working with MQTT library <a href="https://github.com/knolleary/pubsubclient">Pubsubclient</a>,</li>
<li>&#8211; the AM2302 sensor (temperature and humidity) connected to pin_8 for the survey used library with DHTlib with <a href="https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib">DHTlib</a> resource github.com,</li>
<li>&#8211; led <strong>led_green</strong> is connected to pin_9, control in discrete mode on/off</li>
<li>&#8211; broker – ioBroker system driver mqtt.</li>
</ul>
<p>Format topics of data exchange:</p>
<ul>
<li><code>example1/send_interval</code> &#8211; client signed to change the transmission interval of the temperature readings and humidity (int value in seconds),</li>
<li><code>example1/temp</code> &#8211; client publishes a specified temperature interval with DHT22 sensor (float type),</li>
<li><code>example1/hum</code> &#8211; client publishes a specified humidity value intervals with DHT22 sensor (float type),</li>
<li><code>example1/led</code> &#8211; the client is subscribed to the state change of the led (the text on/off or 0/1 or true/false).</li>
</ul>
<p>Driver settings will be as follows:</p>
<p><a href="wp-content\uploads\5.png"><img class="alignnone size-medium wp-image-6605" src="wp-content\uploads\5-283x300.png" alt="" width="283" height="300" srcset="wp-content\uploads\5-283x300.png 283w, wp-content\uploads\5-142x150.png 142w, wp-content\uploads\5-100x106.png 100w, wp-content\uploads\5-150x159.png 150w, wp-content\uploads\5-200x212.png 200w, wp-content\uploads\5-300x318.png 300w, wp-content\uploads\5-450x477.png 450w, wp-content\uploads\5-600x636.png 600w, wp-content\uploads\5.png 805w" sizes="(max-width: 283px) 100vw, 283px"></a></p>
<p>Connecting via TCP (WebSocket is not necessary), default port 1883. The client within the local network, so to encrypt traffic and authenticate the user is not necessary. We will send only the changes since the client signed on the send interval indications and led state to obtain information about the update (without changing the value) to a variable makes no sense.<br>
To publish the subscription &#8211; note this option, as when you first connect (or connected after disconnection) of the client, he must know the state of the variables on which it is signed (a current interval of sending and whether the LED is to be turned on). Setting to send variables ack = true or false is also worth noting, as a variable (which signed the client) can change any driver / script / VIS and any changes should be sent to the client.</p>
<p>The complete code for the arduino board will look like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5cefa788cc2dc098530863" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Zeilennummern"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Unformatierte Code-Ansicht"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Zeilenumbruch umschalten"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Code aufklappen"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Code in einem neuen Fenster anzeigen"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Connecting libraries
#include
#include
#include //https://github.com/knolleary/pubsubclient
#include //https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib
//Settings of a network
byte mac[] = {
  0xAB,
  0xBC,
  0xCD,
  0xDE,
  0xEF,
  0x31
};
byte ip[] = {
  192,
  168,
  69,
  31
}; //arduino board IP address
byte mqttserver[] = {
  192,
  168,
  69,
  51
}; // ioBroker server IP address
EthernetClient ethClient;
void callback(char * topic, byte * payload, unsigned int length);
PubSubClient client(mqttserver, 1883, callback, ethClient);
//Global variables
#define LED_pin 9
unsigned int send_interval = 10; // the sending interval of indications to the server, by default 10 seconds
unsigned long last_time = 0; // the current time for the timer
dht DHT;
#define DHT22_PIN 8
char buff[20];
// The processing function for incoming connections - reception of data on a subscription
void callback(char * topic, byte * payload, unsigned int length) {
  Serial.println("");
  Serial.println("-------");
  Serial.println("New callback of MQTT-broker");
  // let's transform a subject (topic) and value (payload) to a line
  payload[length] = '\0';
  String strTopic = String(topic);
  String strPayload = String((char * ) payload);
  // research that "arrived" from the server on a subscription::
  // Change of an interval of inquiry
  if (strTopic == "example1/send_interval") {
    int tmp = strPayload.toInt();
    if (tmp == 0) {
      send_interval = 10;
    } else {
      send_interval = strPayload.toInt();
    }
  }
  // Control of a LED
  if (strTopic == "example1/led") {
    if (strPayload == "off" || strPayload == "0" || strPayload == "false") digitalWrite(LED_pin, LOW);
    if (strPayload == "on" || strPayload == "1" || strPayload == "true") digitalWrite(LED_pin, HIGH);
  }
  Serial.print(strTopic);
  Serial.print(" ");
  Serial.println(strPayload);
  Serial.println("-------");
  Serial.println("");
}
void setup() {
  Serial.begin(9600);
  Serial.println("Start...");
  // start network connection
  Ethernet.begin(mac, ip);
  Serial.print("IP: ");
  Serial.println(Ethernet.localIP());
  // initialize input/output ports, register starting values
  pinMode(LED_pin, OUTPUT);
  digitalWrite(LED_pin, LOW); // when the LED is off
}
void loop() {
  // If the MQTT connection inactively, then we try to set it and to publish/subscribe
  if (!client.connected()) {
    Serial.print("Connect to MQTT-boker... ");
    // Connect and publish / subscribe
    if (client.connect("example1")) {
      Serial.println("success");
      // Value from sensors
      if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
        dtostrf(DHT.humidity, 5, 2, buff);
        client.publish("example1/hum", buff);
        dtostrf(DHT.temperature, 5, 2, buff);
        client.publish("example1/temp", buff);
      }
      // subscribe for an inquiry interval
      client.subscribe("example1/send_interval");
      // subscribe to the LED control variable
      client.subscribe("example1/led");
    } else {
      // If weren't connected, we wait for 10 seconds and try again
      Serial.print("Failed, rc=");
      Serial.print(client.state());
      Serial.println(" try again in 10 seconds");
      delay(10000);
    }
    // If connection is active, then sends the data to the server with the specified time interval
  } else {
    if (millis() &amp;amp; gt;
      (last_time + send_interval * 1000)) {
      last_time = millis();
      if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
        dtostrf(DHT.humidity, 5, 2, buff);
        client.publish("example1/hum", buff);
        dtostrf(DHT.temperature, 5, 2, buff);
        client.publish("example1/temp", buff);
      }
    }
  }
  // Check of incoming connections on a subscription
  client.loop();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-2">2</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-4">4</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-6">6</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-8">8</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-10">10</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-12">12</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-14">14</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-16">16</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-18">18</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-20">20</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-22">22</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-24">24</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-26">26</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-28">28</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-30">30</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-32">32</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-34">34</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-36">36</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-38">38</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-40">40</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-42">42</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-44">44</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-46">46</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-48">48</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-50">50</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-52">52</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-54">54</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-56">56</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-58">58</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-60">60</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-62">62</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-64">64</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-66">66</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-68">68</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-70">70</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-72">72</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-74">74</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-76">76</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-78">78</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-80">80</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-82">82</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-84">84</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-86">86</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-88">88</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-90">90</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-92">92</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-94">94</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-96">96</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-98">98</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-100">100</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-102">102</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-104">104</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-106">106</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-108">108</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-110">110</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-112">112</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-114">114</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-116">116</div><div class="crayon-num" data-line="crayon-5cefa788cc2dc098530863-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2dc098530863-118">118</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-1"><span class="crayon-c">// Connecting libraries</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-2"><span class="crayon-p">#include</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-3"><span class="crayon-p">#include</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-4"><span class="crayon-p">#include //https://github.com/knolleary/pubsubclient</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-5"><span class="crayon-p">#include //https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-6"><span class="crayon-c">//Settings of a network</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-7"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">mac</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0xAB</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0xBC</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0xCD</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0xDE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0xEF</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0x31</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-14"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-15"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">192</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">168</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">69</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">31</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-20"><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//arduino board IP address</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-21"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">mqttserver</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-22"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">192</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">168</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-24"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">69</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">51</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-26"><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// ioBroker server IP address</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-27"><span class="crayon-e">EthernetClient </span><span class="crayon-v">ethClient</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-28"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">topic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-29"><span class="crayon-e">PubSubClient </span><span class="crayon-e">client</span><span class="crayon-sy">(</span><span class="crayon-v">mqttserver</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1883</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ethClient</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-30"><span class="crayon-c">//Global variables</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-31"><span class="crayon-p">#define LED_pin 9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-32"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// the sending interval of indications to the server, by default 10 seconds</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-33"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// the current time for the timer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-34"><span class="crayon-e">dht </span><span class="crayon-v">DHT</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-35"><span class="crayon-p">#define DHT22_PIN 8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-36"><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">[</span><span class="crayon-cn">20</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-37"><span class="crayon-c">// The processing function for incoming connections - reception of data on a subscription</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-38"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">topic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-40"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"-------"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"New callback of MQTT-broker"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-42"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// let's transform a subject (topic) and value (payload) to a line</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-43"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">payload</span><span class="crayon-sy">[</span><span class="crayon-v">length</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\0'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-44"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-v">topic</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-45"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-46"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// research that "arrived" from the server on a subscription::</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-47"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// Change of an interval of inquiry</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-48"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"example1/send_interval"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-sy">.</span><span class="crayon-e">toInt</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-sy">.</span><span class="crayon-e">toInt</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-55"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-56"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// Control of a LED</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-57"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"example1/led"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"off"</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"false"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">digitalWrite</span><span class="crayon-sy">(</span><span class="crayon-v">LED_pin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">LOW</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"on"</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"true"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">digitalWrite</span><span class="crayon-sy">(</span><span class="crayon-v">LED_pin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">HIGH</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-60"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-61"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-62"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">" "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-63"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">strPayload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-64"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"-------"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-65"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-66"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-67"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-68"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-cn">9600</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-69"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"Start..."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-70"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// start network connection</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-71"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-v">mac</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-72"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"IP: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-73"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">Ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">localIP</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-74"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// initialize input/output ports, register starting values</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-75"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">pinMode</span><span class="crayon-sy">(</span><span class="crayon-v">LED_pin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">OUTPUT</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-76"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">digitalWrite</span><span class="crayon-sy">(</span><span class="crayon-v">LED_pin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">LOW</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// when the LED is off</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-77"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-78"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-79"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// If the MQTT connection inactively, then we try to set it and to publish/subscribe</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-80"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">connected</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Connect to MQTT-boker... "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Connect and publish / subscribe</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-s">"example1"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"success"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Value from sensors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example1/hum"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example1/temp"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// subscribe for an inquiry interval</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">"example1/send_interval"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// subscribe to the LED control variable</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">"example1/led"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If weren't connected, we wait for 10 seconds and try again</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Failed, rc="</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">state</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">" try again in 10 seconds"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">delay</span><span class="crayon-sy">(</span><span class="crayon-cn">10000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If connection is active, then sends the data to the server with the specified time interval</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-104"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">gt</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">send_interval *</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example1/hum"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example1/temp"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-115"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-116"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">// Check of incoming connections on a subscription</span></div><div class="crayon-line" id="crayon-5cefa788cc2dc098530863-117"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2dc098530863-118"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0191 seconds] -->
<p>The result of the part of the broker (temperature and humidity data is updated with the preset time period):</p>
<p><a href="wp-content\uploads\6.png"><img class="wp-image-6606 size-large aligncenter" src="wp-content\uploads\6-1024x201-1.png" alt="" width="750" height="147" srcset="wp-content\uploads\6-1024x201.png 1024w, wp-content\uploads\6-150x29.png 150w, wp-content\uploads\6-300x59.png 300w, wp-content\uploads\6-100x20.png 100w, wp-content\uploads\6-200x39.png 200w, wp-content\uploads\6-450x88.png 450w, wp-content\uploads\6-600x118.png 600w, wp-content\uploads\6-900x177.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>The result of the client-side (incoming data subscription output to the console for debugging):</p>
<p><a href="wp-content\uploads\MQTT-server4.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-server4.jpg" alt="" width="400" height="580"></a></p>
<p>&nbsp;</p>
<h2><span id="IoBroker_working_as_MQTT-client">IoBroker working as MQTT-client</span></h2>
<p>For an instance MQTT driver earned as a client / subscriber &#8211; you need to choose the appropriate type of configuration. In this set of options will change slightly:</p>
<p><img class="wp-image-6794 aligncenter" src="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947.jpg" alt="" width="598" height="670" srcset="wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-1.jpg 809w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-134x150.jpg 134w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-268x300.jpg 268w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-100x112.jpg 100w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-150x168.jpg 150w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-200x224.jpg 200w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-300x336.jpg 300w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-450x505.jpg 450w, wp-content\uploads\ioBroker_Adapter_MQTT_Konfig_Client-e1510689576947-600x673.jpg 600w" sizes="(max-width: 598px) 100vw, 598px"></p>
<p>&nbsp;</p>
<h3><span id="Allgemeine_Einstellungen-2">Allgemeine Einstellungen</span></h3>
<ul>
<li>Typ</li>
</ul>
<p>&nbsp;</p>
<h3><span id="Verbindungseinstellungen-2">Verbindungseinstellungen</span></h3>
<p>&#8211; specifies the URL and port of the broker (if you want to encrypt traffic, indicated SSL) &#8211; settings to connect to the broker,</p>
<p>&nbsp;</p>
<h3><span id="Authentication_settings"><strong>Authentication settings </strong></span></h3>
<ul>
<li>&#8211; user name and password, if the broker requires authentication (it is appropriate to use SSL to avoid transmitting the password in clear text),</li>
</ul>
<p>&nbsp;</p>
<h3><span id="MQTT_Einstellungen-2">MQTT Einstellungen</span></h3>
<ul>
<li><strong>Patterns</strong> &#8211; a mask for variables for which the customer subscribes (variables broker), the values are listed separated by commas, the # (pound) is used to indicate the set,</li>
<li><strong>Mask private values</strong> &#8211; filter variables that should be published (client variables) whose values are listed separated by commas, for indicating a set use the symbol * (asterisk),</li>
<li><strong>To send only changes</strong> &#8211; the client will publish only the variables that changed value (according to mask),</li>
<li><strong>To give private values at startup</strong> &#8211; if this option is checked, the will be <span id="result_box" lang="en"><span title="Publish all states at start - Publish all states (defined by state mask) every time by connection establishment to announce own available states and their values. ">published all the States (according to mask) every time a connection is established, to declare the available variables and their values,</span></span></li>
<li><strong>The prefix for all values</strong> &#8211; if the specified value, it will be added as a prefix to each published topic, for example, if you specify client1 /, then all topics will be published the following lines: <code>client1/javascript/0/cubietruck</code>,</li>
<li><strong>Output log for each change</strong> &#8211; in the log file will display debugging information for each change,</li>
<li><strong>To send not only the team, but also the state (ack = true)</strong> &#8211; if this option is not checked, the broker only sent variables / commands with ack = false, if the option to note that will be sent to all data, regardless of ack = true or ack = false,</li>
<li><strong>The maximum length of a topic</strong> &#8211; the maximum number of characters for the description of the topic, including service.</li>
</ul>
<p>Examples for setting the subscription mask variables (patterns). Consider topics:</p>
<ul>
<li>&#8220;Sport&#8221;</li>
<li>&#8220;Sport/Tennis&#8221;</li>
<li>&#8220;Sport/Basketball&#8221;</li>
<li>&#8220;Sport/Swimming&#8221;</li>
<li>&#8220;Sport/Tennis/Finals&#8221;</li>
<li>&#8220;Sport/Basketball/Finals&#8221;</li>
<li>&#8220;Sport/Swimming/Finals&#8221;</li>
</ul>
<p>If you want to subscribe to a certain set of topics, you can use the characters # (pound sign) or + (plus sign).</p>
<ul>
<li>&#8220;Sport/Tennis/#&#8221; (subscription only &#8220;Sport/Tennis&#8221; and &#8220;Sport/Tennis/Finals&#8221;)</li>
<li>&#8220;Sport/Tennis/+&#8221; (subscription only &#8220;Sport/Tennis/Finals&#8221;, but not &#8220;Sport/Tennis&#8221;)</li>
</ul>
<p>For JMS topics, if you want to subscribe to all topics &#8220;Finals&#8221;, you can use the characters # (pound sign) or + (plus sign)</p>
<ul>
<li>&#8220;Sport/#/Finals&#8221;</li>
<li>&#8220;Sport/+/Finals&#8221;</li>
</ul>
<p>For MQTT topics if you want to subscribe to all topics &#8220;Finals&#8221;, you can use the + (plus sign)</p>
<ul>
<li>&#8220;Sport/+/Finals&#8221;</li>
</ul>
<p>As an example, consider the exchange of data between the two systems ioBroker.</p>
<p>There is a working system ioBroker for BananaPi-Board (IP address 192.168.69.51), it launched MQTT- driver in the server/broker mode from the example above. To the server connects a client that publishes data from the sensor DHT22 – temperature and humidity, as well as signed variables of interval measurement transmission and the status led (enable/disable) – in the example above.</p>
<p>The second operating system ioBroker on the Board Cubietruck, it will run the MQTT driver in a client/subscriber mode. He signs up for the variables temperature and humidity of the broker (which, in turn, receives from another client) and will publish all the script variables &#8211; <a href="index-116.htm?page_id=4268&amp;lang=ru#_Li-polLi-ion">the state of the battery</a> board (only the changes).</p>
<p>Client configuration will be similar to the following:</p>
<p><a href="wp-content\uploads\7.png"><img class="alignnone size-medium wp-image-6607" src="wp-content\uploads\7-284x300.png" alt="" width="284" height="300" srcset="wp-content\uploads\7-284x300.png 284w, wp-content\uploads\7-142x150.png 142w, wp-content\uploads\7-100x106.png 100w, wp-content\uploads\7-150x158.png 150w, wp-content\uploads\7-200x211.png 200w, wp-content\uploads\7-300x317.png 300w, wp-content\uploads\7-450x475.png 450w, wp-content\uploads\7-600x634.png 600w, wp-content\uploads\7.png 805w" sizes="(max-width: 284px) 100vw, 284px"></a></p>
<p>Connection type – the customer/subscriber indicates the IP address of the broker and the port (default 1883). Traffic encryption and authentication is not needed. Mask for the subscriptions (Patterns) &#8211; <code>mqtt/0/example1/hum,mqtt/0/example1/temp</code> &#8211; client is subscribed only on temperature and humidity (values separated by comma without spaces). Mask the data for publication &#8211; <code>javascript.0.cubietruck.battery.*</code> &#8211; publish all the script variables <code>cubietruck</code> in the group <code>battery</code> driver <code>javascript.0</code>.</p>
<p>To send only the changes &#8211; send state variables batteries (makes no sense to send if the value has not changed). To give private values at startup – when starting the driver, the client immediately will release all variables according to the mask – even if they are null or empty to create variables in the broker. To send data with ack=false, variables work battery updated driver javascript, so they are always ack=false.</p>
<p>The result of the work on the client side (temperature and humidity data of another customer &#8211; see the example above):</p>
<p><a href="wp-content\uploads\9.png"><img class="alignnone size-large wp-image-6608" src="wp-content\uploads\9-1024x267.png" alt="" width="750" height="196" srcset="wp-content\uploads\9-1024x267.png 1024w, wp-content\uploads\9-150x39.png 150w, wp-content\uploads\9-300x78.png 300w, wp-content\uploads\9-100x26.png 100w, wp-content\uploads\9-200x52.png 200w, wp-content\uploads\9-450x117.png 450w, wp-content\uploads\9-600x157.png 600w, wp-content\uploads\9-900x235.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>The result of the broker (status data of the battery client):</p>
<p><a href="wp-content\uploads\11.png"><img class="alignnone size-large wp-image-6609" src="wp-content\uploads\11-1024x297.png" alt="" width="750" height="218" srcset="wp-content\uploads\11-1024x297.png 1024w, wp-content\uploads\11-150x44.png 150w, wp-content\uploads\11-300x87.png 300w, wp-content\uploads\11-100x29.png 100w, wp-content\uploads\11-200x58.png 200w, wp-content\uploads\11-450x131.png 450w, wp-content\uploads\11-600x174.png 600w, wp-content\uploads\11-900x261.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<h2><span id="Application_8211_MQTT_gateway_protocols_8211_ModBus_RTU">Application &#8211; MQTT gateway protocols &#8211; ModBus RTU</span></h2>
<p>Driver MQTT can be used as a gateway for various protocols to connect new devices to the system ioBroker or any other. A universal basis for the development of such solutions are arduino boards. In a network many examples, libraries and best practices. A huge community is working with these controllers, and the system integrated a variety of devices/equipment/devices. For example, consider the common industrial protocol ModBus. In ioBroker system has a driver to work with it &#8211; version ModBus TCP (over ethernet). A set of sensors, controllers and actuators work physically on the RS-485 Network / 232 and ModBus RTU protocol. In order to integrate them can be applied MQTT Gateway &#8211; ModBus RTU based on arduino platform. Consider an example.</p>
<p><span style="text-decoration: underline;"><strong>There is a temperature and humidity sensor </strong></span>(for the test on the basis of arduino pro mini board DHT22 Sensor), that outputs data via ModBUS RTU:</p>
<ul>
<li>Port UART (you can use MAX485 chip to convert RS-485 interface) running at 9600 with options 8E1 (1 start bit, 8 data bits, 1 Even parity bit, 1 stop bit),</li>
<li>the address of the ModBus – 10,</li>
<li>temperature address 0 the value multiplied by 10 (the reader function 3),</li>
<li>humidity – address 1 value multiplied by 10 (read function 3),</li>
<li>PWM LED address 2 value 0&#8230;1023 to check the recording function (write function 6).</li>
</ul>
<p>Connection scheme:</p>
<figure style="width: 401px" class="wp-caption alignnone"><a href="wp-content\uploads\MQTT-example-modbus1.jpg"><img src="wp-content\uploads\MQTT-example-modbus1.jpg" width="401" height="280"></a><figcaption class="wp-caption-text">by Fritzing</figcaption></figure>
<p>Code for arduino pro mini controller produces the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5cefa788cc2f7865183446" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Zeilennummern"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Unformatierte Code-Ansicht"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Zeilenumbruch umschalten"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Code aufklappen"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Code in einem neuen Fenster anzeigen"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#include  //https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib
#include  //https://code.google.com/archive/p/simple-modbus/
#include  //https://github.com/PaulStoffregen/MsTimer2
// modbus registers
enum {
    TEMP,
    HUM,
    PWM,
    TEST,
    HOLDING_REGS_SIZE
};
#define ID_MODBUS 10 // modbus address of the slave device
unsigned int holdingRegs[HOLDING_REGS_SIZE]; // modbus register array
// temperature and humidity sensor DHT22
dht DHT;
#define DHT22_PIN 2
#define LED 9 // LED is connected to the PWM pin-9
void setup()
{
    // configure the modbus
    modbus_configure(&amp;amp; Serial, 9600, SERIAL_8E1, ID_MODBUS, 0, HOLDING_REGS_SIZE, holdingRegs);
    holdingRegs[TEST] = -157; // for the test of the negative values
    // initialize a timer for 2 seconds update data in temperature and humidity registers
    MsTimer2::set(2000, read_sensors);
    MsTimer2::start(); // run timer
    pinMode(LED, OUTPUT); // LED port initialization
}
// the function launched by timer each 2 seconds
void read_sensors()
{
    if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
        if
            data from the sensor DHT22 managed to be read
                // we write integer value in the register of humidity
                holdingRegs[HUM]
                = 10 * DHT.humidity;
        // we write integer value in the register of temperature
        holdingRegs[TEMP] = 10 * DHT.temperature;
    }
    else {
        // if it wasn't succeeded to read data from the sensor DHT22, we write zero in registers
        holdingRegs[HUM] = 0;
        holdingRegs[TEMP] = 0;
    }
}
void loop()
{
    modbus_update(); // modbus data update
    // data from the LED control register transmit to the PWM (bit shift by 2 bits)
    analogWrite(LED, holdingRegs[PWM] &amp;amp; gt; &amp;gt; 2);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-2">2</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-4">4</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-6">6</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-8">8</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-10">10</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-12">12</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-14">14</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-16">16</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-18">18</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-20">20</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-22">22</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-24">24</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-26">26</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-28">28</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-30">30</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-32">32</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-34">34</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-36">36</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-38">38</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-40">40</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-42">42</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-44">44</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-46">46</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-48">48</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc2f7865183446-50">50</div><div class="crayon-num" data-line="crayon-5cefa788cc2f7865183446-51">51</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-1"><span class="crayon-p">#include&nbsp;&nbsp;//https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-2"><span class="crayon-p">#include&nbsp;&nbsp;//https://code.google.com/archive/p/simple-modbus/</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-3"><span class="crayon-p">#include&nbsp;&nbsp;//https://github.com/PaulStoffregen/MsTimer2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-4"><span class="crayon-c">// modbus registers</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-5"><span class="crayon-t">enum</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TEMP</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">HUM</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">PWM</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TEST</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">HOLDING_REGS</span><span class="crayon-sy">_</span>SIZE</div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-11"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-12"><span class="crayon-p">#define ID_MODBUS 10 // modbus address of the slave device</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-13"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">HOLDING_REGS_SIZE</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// modbus register array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-14"><span class="crayon-c">// temperature and humidity sensor DHT22</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-15"><span class="crayon-e">dht </span><span class="crayon-v">DHT</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-16"><span class="crayon-p">#define DHT22_PIN 2</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-17"><span class="crayon-p">#define LED 9 // LED is connected to the PWM pin-9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-18"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-19"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// configure the modbus</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">modbus_configure</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">Serial</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">9600</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">SERIAL_8E1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ID_MODBUS</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">HOLDING_REGS_SIZE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">TEST</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">157</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// for the test of the negative values</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// initialize a timer for 2 seconds update data in temperature and humidity registers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">MsTimer2</span><span class="crayon-o">::</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-cn">2000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">read_sensors</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">MsTimer2</span><span class="crayon-o">::</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// run timer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">pinMode</span><span class="crayon-sy">(</span><span class="crayon-v">LED</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">OUTPUT</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// LED port initialization</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-27"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-28"><span class="crayon-c">// the function launched by timer each 2 seconds</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-29"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">read_sensors</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-30"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">data </span><span class="crayon-e">from </span><span class="crayon-e">the </span><span class="crayon-e">sensor </span><span class="crayon-e">DHT22 </span><span class="crayon-e">managed </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-e">be </span><span class="crayon-v">read</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// we write integer value in the register of humidity</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">HUM</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// we write integer value in the register of temperature</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">TEMP</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// if it wasn't succeeded to read data from the sensor DHT22, we write zero in registers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">HUM</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">TEMP</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-45"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-46"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-47"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">modbus_update</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// modbus data update</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// data from the LED control register transmit to the PWM (bit shift by 2 bits)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc2f7865183446-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">analogWrite</span><span class="crayon-sy">(</span><span class="crayon-v">LED</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">holdingRegs</span><span class="crayon-sy">[</span><span class="crayon-v">PWM</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc2f7865183446-51"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0066 seconds] -->
<p>To test the operation code and schema, you can connect to port serial board (for example, using a USB-UART Converter) and a special program to interview just made the temperature sensor and humidity with ModBus RTU interface. For the survey can be used, for example, <a href="http://qmodbus.sourceforge.net/">qmodbus</a> or any other program.</p>
<p>Settings:</p>
<ul>
<li>port (choose from the list which port is connected to the serial Arduino boards);</li>
<li>speed and other parameters – 9600 8E1;</li>
<li>slave id: 10, read: function No. 3 read holding registers, starting address: 0, number of registers: 3,</li>
<li>slave id: 10, record: function No. 6 write single register start address: 2,</li>
</ul>
<p>The answer in the program when reading should be approximately the following:</p>
<p><a href="wp-content\uploads\MQTT-example-modbus2.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-example-modbus2.jpg" width="401" height="242"></a></p>
<p>The answer in the program when recording:</p>
<p><a href="wp-content\uploads\MQTT-example-modbus3.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-example-modbus3.jpg" width="400" height="241"></a></p>
<p><span style="text-decoration: underline;"><strong>Now configure the gateway itself and connect it to the iobroker</strong></span></p>
<p>The gateway will be based on the platform arduino MEGA 2560 with ethernet shield &#8211; client MQTT, broker &#8211; an instance mqtt.0 ioBroker system driver. Choosing the MEGA 2560 due to the fact that on this Board more than one UART port, respectively, is zero Serial0 (pin_0 (RX) and pin_1 (TX)) or simply Serial – use to output debug messages, and Serial1 (pin_19 (RX) and pin_18 (TX)) – for slave via ModBus.</p>
<ul>
<li>the client – the fee for developing arduino MEGA 2560 + ethernet shield based on W5100 chip;</li>
<li>to work with the ethernet board uses the <a href="https://www.arduino.cc/en/Reference/Ethernet">standard library</a> for working with MQTT library <a href="https://github.com/knolleary/pubsubclient">Pubsubclient</a>;</li>
<li>for the survey on the modbus use library <a href="https://code.google.com/archive/p/simple-modbus/">SimpleModbus</a> version master;</li>
<li>survey on UART port (just connect the RX port master, TX port slave and respectively TX port master, RX port slave), transmission control port is not used (it is for RS-485);</li>
<li>port settings: speed 9600, 8Е1;</li>
<li>&#8211; the address of the slave device 10, a function of reading number 3 (read holding registers), recording function no. 6 (write single register);</li>
<li>&#8211; broker – ioBroker system driver mqtt.</li>
</ul>
<p>Format topics of data exchange:</p>
<ul>
<li><code>modbusgateway/send_interval</code> &#8211; client signed to change the transmission interval of the temperature readings and humidity (int value in seconds),</li>
<li><code>modbusgateway/temp</code> &#8211; client publishes with a a given interval the value of the temperature sensor DHT22 (type float),</li>
<li><code>modbusgateway/hum</code> &#8211; the client publishes with a given interval the value of the humidity sensor DHT22 (type float),</li>
<li><code>modbusgateway/led</code> &#8211; the client is subscribed to the state change of the led (PWM control value 0&#8230;1024).</li>
</ul>
<p>СThe connection diagram will look something like this:</p>
<figure style="width: 699px" class="wp-caption alignnone"><a href="wp-content\uploads\MQTT-example-modbus6.jpg"><img src="wp-content\uploads\MQTT-example-modbus6.jpg" width="699" height="250"></a><figcaption class="wp-caption-text">By Fritzing</figcaption></figure>
<p>For the test slave device energized from the master device. The Master in turn will work from the USB port, which is being debug (Serial0).</p>
<p>Driver settings will be as follows:</p>
<p><a href="wp-content\uploads\14.png"><img class="alignnone size-medium wp-image-6610" src="wp-content\uploads\14-283x300.png" alt="" width="283" height="300" srcset="wp-content\uploads\14-283x300.png 283w, wp-content\uploads\14-142x150.png 142w, wp-content\uploads\14-100x106.png 100w, wp-content\uploads\14-150x159.png 150w, wp-content\uploads\14-200x212.png 200w, wp-content\uploads\14-300x318.png 300w, wp-content\uploads\14-450x477.png 450w, wp-content\uploads\14-600x636.png 600w, wp-content\uploads\14.png 805w" sizes="(max-width: 283px) 100vw, 283px"></a></p>
<p>Connecting via TCP (WebSocket is not necessary), default port 1883. The client within the local network, so to encrypt traffic and authenticate the user is not necessary. We will send only the changes since the client signed on the send interval indications and led state to obtain information about the update (without changing the value) to a variable makes no sense. To publish the subscription &#8211; note this option, as when you first connect (or connected after disconnection) of the client, he must know the state of the variables on which it is signed (a current interval of sending and whether the LED is to be turned on). Setting to send variables ack = true or false is also worth noting, as a variable (which signed the client) can change any driver / script / VIS and any changes should be sent to the client.</p>
<p>The complete code for the arduino board will look like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5cefa788cc308767176483" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Zeilennummern"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Unformatierte Code-Ansicht"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Zeilenumbruch umschalten"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Code aufklappen"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Code in einem neuen Fenster anzeigen"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Connecting libraries
#include 
#include 
#include  //https://github.com/knolleary/pubsubclient
#include  //https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib
// Settings of a network
byte mac[] = { 0xAB, 0xBC, 0xCD, 0xDE, 0xEF, 0x31 };
byte ip[] = { 192, 168, 69, 31 }; // arduino board IP address
byte mqttserver[] = { 192, 168, 69, 51 }; // ioBroker server IP address
EthernetClient ethClient;
void callback(char* topic, byte* payload, unsigned int length);
PubSubClient client(mqttserver, 1884, callback, ethClient);
// Global variables
unsigned int send_interval = 10; // the sending interval of indications to the server, by default 10 seconds
unsigned long last_time = 0; // the current time for the timer
dht DHT;
#define DHT22_PIN 8
char buff[20];
//The processing function for incoming connections - reception of data on a subscription
void callback(char* topic, byte* payload, unsigned int length)
{
    Serial.println("");
    Serial.println("-------");
    Serial.println("New callback of MQTT-broker");
    // let's transform a subject (topic) and value (payload) to a line
    payload[length] = '\0';
    String strTopic = String(topic);
    String strPayload = String((char*)payload);
    // Research that "arrived" from the server on a subscription:
    // Change of an interval of inquiry
    if (strTopic == "example2/send_interval") {
        int tmp = strPayload.toInt();
        if (tmp == 0) {
            send_interval = 10;
        }
        else {
            send_interval = strPayload.toInt();
        }
    }
    Serial.print(strTopic);
    Serial.print(" ");
    Serial.println(strPayload);
    Serial.println("-------");
    Serial.println("");
}
void setup()
{
    Serial.begin(9600);
    Serial.println("Start...");
    // start network connection
    Ethernet.begin(mac, ip);
    Serial.print("IP: ");
    Serial.println(Ethernet.localIP());
    // initialize input/output ports, register starting values
}
void loop()
{
    // If the MQTT connection inactively, then we try to set it and to publish/subscribe
    if (!client.connected()) {
        Serial.print("Connect to MQTT-boker... ");
        // Connect and publish / subscribe
        if (client.connect("example2")) {
            Serial.println("success");
            // Value from sensors
            if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
                dtostrf(DHT.humidity, 5, 2, buff);
                client.publish("example2/hum", buff);
                dtostrf(DHT.temperature, 5, 2, buff);
                client.publish("example2/temp", buff);
            }
            // Subscribe for an inquiry interval
            client.subscribe("example2/send_interval");
        }
        else {
            // If weren't connected, we wait for 10 seconds and try again
            Serial.print("Failed, rc=");
            Serial.print(client.state());
            Serial.println(" try again in 10 seconds");
            delay(10000);
        }
        // If connection is active, then sends the data to the server with the specified time interval
    }
    else {
        if (millis() &amp;amp; gt; (last_time + send_interval * 1000)) {
            last_time = millis();
            if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
                dtostrf(DHT.humidity, 5, 2, buff);
                client.publish("example2/hum", buff);
                dtostrf(DHT.temperature, 5, 2, buff);
                client.publish("example2/temp", buff);
            }
        }
    }
    // Check of incoming connections on a subscription
    client.loop();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-2">2</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-4">4</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-6">6</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-8">8</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-10">10</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-12">12</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-14">14</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-16">16</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-18">18</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-20">20</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-22">22</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-24">24</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-26">26</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-28">28</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-30">30</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-32">32</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-34">34</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-36">36</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-38">38</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-40">40</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-42">42</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-44">44</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-46">46</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-48">48</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-50">50</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-52">52</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-54">54</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-56">56</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-58">58</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-60">60</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-62">62</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-64">64</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-66">66</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-68">68</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-70">70</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-72">72</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-74">74</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-76">76</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-78">78</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-80">80</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-82">82</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-84">84</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-86">86</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-88">88</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-90">90</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-92">92</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-94">94</div><div class="crayon-num" data-line="crayon-5cefa788cc308767176483-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc308767176483-96">96</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5cefa788cc308767176483-1"><span class="crayon-c">// Connecting libraries</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-2"><span class="crayon-p">#include </span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-3"><span class="crayon-p">#include </span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-4"><span class="crayon-p">#include&nbsp;&nbsp;//https://github.com/knolleary/pubsubclient</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-5"><span class="crayon-p">#include&nbsp;&nbsp;//https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-6"><span class="crayon-c">// Settings of a network</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-7"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">mac</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">0xAB</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xBC</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xCD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xDE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xEF</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x31</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-8"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">192</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">168</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">31</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// arduino board IP address</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-9"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">mqttserver</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">192</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">168</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">51</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// ioBroker server IP address</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-10"><span class="crayon-e">EthernetClient </span><span class="crayon-v">ethClient</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-11"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">topic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-12"><span class="crayon-e">PubSubClient </span><span class="crayon-e">client</span><span class="crayon-sy">(</span><span class="crayon-v">mqttserver</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1884</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ethClient</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-13"><span class="crayon-c">// Global variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-14"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// the sending interval of indications to the server, by default 10 seconds</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-15"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// the current time for the timer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-16"><span class="crayon-e">dht </span><span class="crayon-v">DHT</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-17"><span class="crayon-p">#define DHT22_PIN 8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-18"><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">[</span><span class="crayon-cn">20</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-19"><span class="crayon-c">//The processing function for incoming connections - reception of data on a subscription</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-20"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">topic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-21"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"-------"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"New callback of MQTT-broker"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// let's transform a subject (topic) and value (payload) to a line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">payload</span><span class="crayon-sy">[</span><span class="crayon-v">length</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\0'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-v">topic</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-sy">)</span><span class="crayon-v">payload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Research that "arrived" from the server on a subscription:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Change of an interval of inquiry</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"example2/send_interval"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-sy">.</span><span class="crayon-e">toInt</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-sy">.</span><span class="crayon-e">toInt</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">" "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">strPayload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"-------"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-45"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-46"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-47"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-cn">9600</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"Start..."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// start network connection</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-v">mac</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"IP: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">Ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">localIP</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// initialize input/output ports, register starting values</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-55"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-56"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-57"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If the MQTT connection inactively, then we try to set it and to publish/subscribe</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">connected</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Connect to MQTT-boker... "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Connect and publish / subscribe</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-s">"example2"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"success"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Value from sensors</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/hum"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/temp"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Subscribe for an inquiry interval</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/send_interval"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If weren't connected, we wait for 10 seconds and try again</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Failed, rc="</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">state</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">" try again in 10 seconds"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">delay</span><span class="crayon-sy">(</span><span class="crayon-cn">10000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If connection is active, then sends the data to the server with the specified time interval</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">send_interval *</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/hum"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/temp"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Check of incoming connections on a subscription</span></div><div class="crayon-line" id="crayon-5cefa788cc308767176483-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc308767176483-96"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0166 seconds] -->
<p>This solution can be used as a prototype (example) ModBus network in your automation system. The data from the slave is transmitted with the desired spacing in the ioBroker.</p>
<p><a href="wp-content\uploads\10.png"><img class="alignnone size-large wp-image-6611" src="wp-content\uploads\10-1024x202.png" alt="" width="750" height="148" srcset="wp-content\uploads\10-1024x202.png 1024w, wp-content\uploads\10-150x30.png 150w, wp-content\uploads\10-300x59.png 300w, wp-content\uploads\10-100x20.png 100w, wp-content\uploads\10-200x39.png 200w, wp-content\uploads\10-450x89.png 450w, wp-content\uploads\10-600x118.png 600w, wp-content\uploads\10-900x177.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>MQTT client signed variables and redirects needed in slave-device on the ModBus network.</p>
<p><a href="wp-content\uploads\MQTT-example-modbus5.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-example-modbus5.jpg" width="400" height="580"></a></p>
<h2><span id="Application_8211_connecting_mobile_clients">Application &#8211; connecting mobile clients</span></h2>
<p>Recently MQTT protocol became very common due to the simplicity, economy of the traffic and the elaboration of good libraries for different platforms. There are many programs to work with MQTT on mobile devices, for example <a href="https://play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&hl=en">IoT MQTT Dashboard</a>. With this program you can connect to the MQTT broker in a local network or the Internet. Consider an example, in the role of the broker will be the ioBroker system, to which using MQTT to connect the client – application IoT MQTT Dashboard.</p>
<p>In this example, we control the light controller <a href="http://www.ab-log.ru/smart-house/ethernet/megad-328">MegaD-328</a>, which is connected to the ioBroker with the driver <a href="?page_id=4052&lang=en">MegaD</a>. Controls relay (MegaD port <strong>P7</strong>) light in the lobby, a special script, which is signed by the state of the port &#8211; button <strong>P0</strong> and MQTT-variable state <strong>mqtt.0.remotectrl.light.hall</strong>, which will publish the mobile client. This script toggles the state of the port that is bound to the switch (port P7), ie inverts it. It turns out that each time you press the button, electrically connected to port <strong>P0</strong> (caught the <strong>true</strong> state) and every time you publish variable <strong>mqtt.0.remotectrl.light.hall </strong>value as <strong>true</strong>, the port <strong>P7</strong> to turn on or off the light.</p>
<p>The text of the script will be like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5cefa788cc315370906718" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Zeilennummern"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Unformatierte Code-Ansicht"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Zeilenumbruch umschalten"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Code aufklappen"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Code in einem neuen Fenster anzeigen"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Control of lighting in the hall by means of the button p0 port of the MegaD controller the driver instance megad.0
on({ id : 'megad.0.p0_P0', change : 'any' }, function(obj) {
    if (obj.newState.val != = '' || typeof obj.newState.val != = "undefined") {
        if (obj.newState.val == = true) {
            if (getState('megad.0.p7_P7').val == = true) {
                setState('megad.0.p7_P7', false);
            }
            else {
                setState('megad.0.p7_P7', true);
            }
        }
    }
});
// Control of lighting in the hall is remote on MQTT a topic "mqtt.0.remotectrl.light.hall"
on({ id : 'mqtt.0.remotectrl.light.hall', change : 'any' }, function(obj) {
    if (obj.newState.val != = '' || typeof obj.newState.val != = "undefined") {
        if (obj.newState.val == = true) {
            if (getState('megad.0.p7_P7').val == = true) {
                setState('megad.0.p7_P7', false);
            }
            else {
                setState('megad.0.p7_P7', true);
            }
        }
    }
});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-2">2</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-4">4</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-6">6</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-8">8</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-10">10</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-12">12</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-14">14</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-16">16</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-18">18</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-20">20</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-22">22</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-24">24</div><div class="crayon-num" data-line="crayon-5cefa788cc315370906718-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc315370906718-26">26</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5cefa788cc315370906718-1"><span class="crayon-c">// Control of lighting in the hall by means of the button p0 port of the MegaD controller the driver instance megad.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-2"><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'megad.0.p0_P0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">change</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'any'</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">obj</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">obj</span><span class="crayon-sy">.</span><span class="crayon-v">newState</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">typeof </span><span class="crayon-v">obj</span><span class="crayon-sy">.</span><span class="crayon-v">newState</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"undefined"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">obj</span><span class="crayon-sy">.</span><span class="crayon-v">newState</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">getState</span><span class="crayon-sy">(</span><span class="crayon-s">'megad.0.p7_P7'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">setState</span><span class="crayon-sy">(</span><span class="crayon-s">'megad.0.p7_P7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">setState</span><span class="crayon-sy">(</span><span class="crayon-s">'megad.0.p7_P7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-13"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-14"><span class="crayon-c">// Control of lighting in the hall is remote on MQTT a topic "mqtt.0.remotectrl.light.hall"</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-15"><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'mqtt.0.remotectrl.light.hall'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">change</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'any'</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">obj</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">obj</span><span class="crayon-sy">.</span><span class="crayon-v">newState</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-e">typeof </span><span class="crayon-v">obj</span><span class="crayon-sy">.</span><span class="crayon-v">newState</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"undefined"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">obj</span><span class="crayon-sy">.</span><span class="crayon-v">newState</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">getState</span><span class="crayon-sy">(</span><span class="crayon-s">'megad.0.p7_P7'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">val</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">setState</span><span class="crayon-sy">(</span><span class="crayon-s">'megad.0.p7_P7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">setState</span><span class="crayon-sy">(</span><span class="crayon-s">'megad.0.p7_P7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc315370906718-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc315370906718-26"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0057 seconds] -->
<p>Connect button and light bulbs to MegaD controller:</p>
<p><a href="wp-content\uploads\mqtt-mobile1.jpg"><img class="alignnone wp-image-6618 size-full" src="wp-content\uploads\mqtt-mobile1.jpg" width="620" height="899" srcset="wp-content\uploads\mqtt-mobile1.jpg 620w, wp-content\uploads\mqtt-mobile1-103x150.jpg 103w, wp-content\uploads\mqtt-mobile1-207x300.jpg 207w, wp-content\uploads\mqtt-mobile1-100x145.jpg 100w, wp-content\uploads\mqtt-mobile1-150x218.jpg 150w, wp-content\uploads\mqtt-mobile1-200x290.jpg 200w, wp-content\uploads\mqtt-mobile1-300x435.jpg 300w, wp-content\uploads\mqtt-mobile1-450x653.jpg 450w, wp-content\uploads\mqtt-mobile1-600x870.jpg 600w" sizes="(max-width: 620px) 100vw, 620px"></a></p>
<p>MQTT driver settings:</p>
<p><a href="wp-content\uploads\14.png"><img class="alignnone size-medium wp-image-6610" src="wp-content\uploads\14-283x300.png" alt="" width="283" height="300" srcset="wp-content\uploads\14-283x300.png 283w, wp-content\uploads\14-142x150.png 142w, wp-content\uploads\14-100x106.png 100w, wp-content\uploads\14-150x159.png 150w, wp-content\uploads\14-200x212.png 200w, wp-content\uploads\14-300x318.png 300w, wp-content\uploads\14-450x477.png 450w, wp-content\uploads\14-600x636.png 600w, wp-content\uploads\14.png 805w" sizes="(max-width: 283px) 100vw, 283px"></a></p>
<p>The mobile client can publish data to variable mqtt.0.remotectrl.light.hall and signs up for a real port status MegaD – megad.0.p7_P7. The configure publishing and subscriptions:</p>
<p><a href="wp-content\uploads\MQTT-example-mobile3.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-mobile3.png" width="300" height="512"> </a><a href="wp-content\uploads\MQTT-example-mobile4.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-mobile4.png" width="300" height="512"></a></p>
<p>In total for one channel light control turn the control window (publish) and subscription window is a real condition light relay (for feedback):</p>
<p><a href="wp-content\uploads\MQTT-example-mobile6.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-mobile5.png" width="300" height="512"> <img class="alignnone" src="wp-content\uploads\MQTT-example-mobile6.png" width="300" height="512"></a></p>
<h2><span id="Application_8211_working_with_cloud_servers">Application &#8211; working with cloud servers</span></h2>
<p>The example described above has several disadvantages. First, it is not always the mobile client may be on the same local network as the server ioBroker, and secondly, even if you implement port forwarding in the Internet and to protect the connection, not always the server itself ioBroker can accept incoming connection (located behind a NAT which has no access to settings). In the global network many different services that support MQTT &#8211; paid and free, for example sending weather data, geolocation, etc. Some services may act as MQTT protocol broker and can be used as a gateway (bridge) to output data from ioBroker the global network, or to obtain data in ioBroker.</p>
<p>As an example, consider the work of the bundles:</p>
<ul>
<li>server / broker &#8211; service <a href="https://www.cloudmqtt.com/">cloudmqtt.com</a> (there is a free tariff),</li>
<li>customer/subscriber – the ioBroker system with access to the Internet, publishes data of temperature and humidity (see <a href="index-88.htm?page_id=6435&amp;lang=en#ioBroker_working_as_MQTT-broker">example above</a>), publishes the real status of ports <strong>P7-P13</strong> (relay driver MegaD <strong>megad.0</strong> – light control), subscribing to properties of the remote light control (an instance of the driver mqtt <strong>mqtt.0</strong>),</li>
<li>килент/подписчик &#8211; приложение <a href="https://play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&hl=en">IoT MQTT Dashboard</a> для удаленной работы &#8211; подписка на данные сенсора температуры и влажности, подписка на реальное состояние портов <strong>P7-P13</strong> (реле MegaD драйвера <strong>megad.0</strong>), публикация переменных удаленного управления светом (экземпляр драйвера <strong>mqtt.0</strong>).<br>
&#8211; customer/subscriber – the application of <a href="https://play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&hl=en">IoT MQTT Dashboard</a> to work remotely – subscribe to sensor data of temperature and humidity, subscription to the real status of ports <strong>P7-P13</strong> (relay driver MegaD <strong>megad.0</strong>), publication of variables of a remote control light (driver instance <strong>mqtt.0</strong>).</li>
</ul>
<p>he result is the following structure:</p>
<p><a href="wp-content\uploads\mqtt-cloud1.jpg"><img class="alignnone wp-image-6619 size-large" src="wp-content\uploads\mqtt-cloud1-1024x511.jpg" width="750" height="374" srcset="wp-content\uploads\mqtt-cloud1-1024x511.jpg 1024w, wp-content\uploads\mqtt-cloud1-150x75.jpg 150w, wp-content\uploads\mqtt-cloud1-300x150.jpg 300w, wp-content\uploads\mqtt-cloud1-100x50.jpg 100w, wp-content\uploads\mqtt-cloud1-200x100.jpg 200w, wp-content\uploads\mqtt-cloud1-450x225.jpg 450w, wp-content\uploads\mqtt-cloud1-600x300.jpg 600w, wp-content\uploads\mqtt-cloud1-900x449.jpg 900w, wp-content\uploads\mqtt-cloud1.jpg 1414w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>Bundle driver <strong>mqtt.1</strong> (broker) – Arduino UNO + Ethernet + DHT22 (client) as in <a href="index-88.htm?page_id=6435&amp;lang=en#ioBroker_working_as_MQTT-broker">the example above</a> with a few modifications. Configuring an instance of the mqtt <strong>driver.1</strong>:</p>
<p><a href="wp-content\uploads\14.png"><img class="alignnone size-medium wp-image-6610" src="wp-content\uploads\14-283x300.png" alt="" width="283" height="300" srcset="wp-content\uploads\14-283x300.png 283w, wp-content\uploads\14-142x150.png 142w, wp-content\uploads\14-100x106.png 100w, wp-content\uploads\14-150x159.png 150w, wp-content\uploads\14-200x212.png 200w, wp-content\uploads\14-300x318.png 300w, wp-content\uploads\14-450x477.png 450w, wp-content\uploads\14-600x636.png 600w, wp-content\uploads\14.png 805w" sizes="(max-width: 283px) 100vw, 283px"></a></p>
<p>Code for the arduino platform:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5cefa788cc322402000990" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Zeilennummern"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Unformatierte Code-Ansicht"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Zeilenumbruch umschalten"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Code aufklappen"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Code in einem neuen Fenster anzeigen"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// Connecting libraries
#include 
#include 
#include  //https://github.com/knolleary/pubsubclient
#include  //https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib
// Settings of a network
byte mac[] = { 0xAB, 0xBC, 0xCD, 0xDE, 0xEF, 0x31 };
byte ip[] = { 192, 168, 69, 31 }; // arduino board IP address
byte mqttserver[] = { 192, 168, 69, 51 }; // ioBroker server IP address
EthernetClient ethClient;
void callback(char* topic, byte* payload, unsigned int length);
PubSubClient client(mqttserver, 1884, callback, ethClient);
// Global variables
unsigned int send_interval = 10; // the sending interval of indications to the server, by default 10 seconds
unsigned long last_time = 0; // the current time for the timer
dht DHT;
#define DHT22_PIN 8
char buff[20];
//The processing function for incoming connections - reception of data on a subscription
void callback(char* topic, byte* payload, unsigned int length)
{
    Serial.println("");
    Serial.println("-------");
    Serial.println("New callback of MQTT-broker");
    // let's transform a subject (topic) and value (payload) to a line
    payload[length] = '\0';
    String strTopic = String(topic);
    String strPayload = String((char*)payload);
    // Research that "arrived" from the server on a subscription:
    // Change of an interval of inquiry
    if (strTopic == "example2/send_interval") {
        int tmp = strPayload.toInt();
        if (tmp == 0) {
            send_interval = 10;
        }
        else {
            send_interval = strPayload.toInt();
        }
    }
    Serial.print(strTopic);
    Serial.print(" ");
    Serial.println(strPayload);
    Serial.println("-------");
    Serial.println("");
}
void setup()
{
    Serial.begin(9600);
    Serial.println("Start...");
    // start network connection
    Ethernet.begin(mac, ip);
    Serial.print("IP: ");
    Serial.println(Ethernet.localIP());
    // initialize input/output ports, register starting values
}
void loop()
{
    // If the MQTT connection inactively, then we try to set it and to publish/subscribe
    if (!client.connected()) {
        Serial.print("Connect to MQTT-boker... ");
        // Connect and publish / subscribe
        if (client.connect("example2")) {
            Serial.println("success");
            // Value from sensors
            if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
                dtostrf(DHT.humidity, 5, 2, buff);
                client.publish("example2/hum", buff);
                dtostrf(DHT.temperature, 5, 2, buff);
                client.publish("example2/temp", buff);
            }
            // Subscribe for an inquiry interval
            client.subscribe("example2/send_interval");
        }
        else {
            // If weren't connected, we wait for 10 seconds and try again
            Serial.print("Failed, rc=");
            Serial.print(client.state());
            Serial.println(" try again in 10 seconds");
            delay(10000);
        }
        // If connection is active, then sends the data to the server with the specified time interval
    }
    else {
        if (millis() &amp;amp; gt; (last_time + send_interval * 1000)) {
            last_time = millis();
            if (DHT.read22(DHT22_PIN) == DHTLIB_OK) {
                dtostrf(DHT.humidity, 5, 2, buff);
                client.publish("example2/hum", buff);
                dtostrf(DHT.temperature, 5, 2, buff);
                client.publish("example2/temp", buff);
            }
        }
    }
    // Check of incoming connections on a subscription
    client.loop();
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-2">2</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-4">4</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-6">6</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-8">8</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-10">10</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-12">12</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-14">14</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-16">16</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-18">18</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-20">20</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-22">22</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-24">24</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-26">26</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-28">28</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-30">30</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-32">32</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-34">34</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-36">36</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-38">38</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-40">40</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-42">42</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-44">44</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-46">46</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-48">48</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-50">50</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-52">52</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-54">54</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-56">56</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-58">58</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-60">60</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-62">62</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-64">64</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-66">66</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-68">68</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-70">70</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-72">72</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-74">74</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-76">76</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-78">78</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-80">80</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-82">82</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-84">84</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-86">86</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-88">88</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-90">90</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-92">92</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-94">94</div><div class="crayon-num" data-line="crayon-5cefa788cc322402000990-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5cefa788cc322402000990-96">96</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5cefa788cc322402000990-1"><span class="crayon-c">// Connecting libraries</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-2"><span class="crayon-p">#include </span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-3"><span class="crayon-p">#include </span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-4"><span class="crayon-p">#include&nbsp;&nbsp;//https://github.com/knolleary/pubsubclient</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-5"><span class="crayon-p">#include&nbsp;&nbsp;//https://github.com/RobTillaart/Arduino/tree/master/libraries/DHTlib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-6"><span class="crayon-c">// Settings of a network</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-7"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">mac</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">0xAB</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xBC</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xCD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xDE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xEF</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0x31</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-8"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">192</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">168</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">31</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// arduino board IP address</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-9"><span class="crayon-t">byte</span><span class="crayon-h"> </span><span class="crayon-v">mqttserver</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">192</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">168</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">51</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// ioBroker server IP address</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-10"><span class="crayon-e">EthernetClient </span><span class="crayon-v">ethClient</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-11"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">topic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-12"><span class="crayon-e">PubSubClient </span><span class="crayon-e">client</span><span class="crayon-sy">(</span><span class="crayon-v">mqttserver</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1884</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ethClient</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-13"><span class="crayon-c">// Global variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-14"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// the sending interval of indications to the server, by default 10 seconds</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-15"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// the current time for the timer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-16"><span class="crayon-e">dht </span><span class="crayon-v">DHT</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-17"><span class="crayon-p">#define DHT22_PIN 8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-18"><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">[</span><span class="crayon-cn">20</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-19"><span class="crayon-c">//The processing function for incoming connections - reception of data on a subscription</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-20"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">topic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">payload</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-21"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"-------"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"New callback of MQTT-broker"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// let's transform a subject (topic) and value (payload) to a line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">payload</span><span class="crayon-sy">[</span><span class="crayon-v">length</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\0'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-v">topic</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-sy">)</span><span class="crayon-v">payload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Research that "arrived" from the server on a subscription:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Change of an interval of inquiry</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"example2/send_interval"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-sy">.</span><span class="crayon-e">toInt</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">send_interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strPayload</span><span class="crayon-sy">.</span><span class="crayon-e">toInt</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">strTopic</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">" "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">strPayload</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"-------"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-45"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-46"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-47"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-cn">9600</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"Start..."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// start network connection</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-v">mac</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ip</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"IP: "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">Ethernet</span><span class="crayon-sy">.</span><span class="crayon-e">localIP</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// initialize input/output ports, register starting values</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-55"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-56"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-57"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If the MQTT connection inactively, then we try to set it and to publish/subscribe</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">connected</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Connect to MQTT-boker... "</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Connect and publish / subscribe</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-s">"example2"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"success"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Value from sensors</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/hum"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/temp"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Subscribe for an inquiry interval</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/send_interval"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If weren't connected, we wait for 10 seconds and try again</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Failed, rc="</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">state</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Serial</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">" try again in 10 seconds"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">delay</span><span class="crayon-sy">(</span><span class="crayon-cn">10000</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// If connection is active, then sends the data to the server with the specified time interval</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">send_interval *</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">last_time</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">millis</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-e">read22</span><span class="crayon-sy">(</span><span class="crayon-v">DHT22_PIN</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">DHTLIB_OK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">humidity</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/hum"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dtostrf</span><span class="crayon-sy">(</span><span class="crayon-v">DHT</span><span class="crayon-sy">.</span><span class="crayon-v">temperature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">"example2/temp"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buff</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Check of incoming connections on a subscription</span></div><div class="crayon-line" id="crayon-5cefa788cc322402000990-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">client</span><span class="crayon-sy">.</span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5cefa788cc322402000990-96"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0151 seconds] -->
<p>The result of the work &#8211; <strong>mqtt.1</strong> driver objects:</p>
<p><a href="wp-content\uploads\12.png"><img class="alignnone size-large wp-image-6613" src="wp-content\uploads\12-1024x187.png" alt="" width="750" height="137" srcset="wp-content\uploads\12-1024x187.png 1024w, wp-content\uploads\12-150x27.png 150w, wp-content\uploads\12-300x55.png 300w, wp-content\uploads\12-100x18.png 100w, wp-content\uploads\12-200x37.png 200w, wp-content\uploads\12-450x82.png 450w, wp-content\uploads\12-600x110.png 600w, wp-content\uploads\12-900x165.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>Now let&#8217;s set up publish/subscribe data to the cloud. For a start, register on the site <a href="https://www.cloudmqtt.com/">cloudmqtt.com</a>, select the desired rate, create instance, get settings:</p>
<p><a href="wp-content\uploads\MQTT-example-cloud4.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud4.jpg" width="400" height="337"></a></p>
<p>For greater security it is better to create a separate user, assume that it will be user <strong>iobroker</strong>with the password <strong>1234</strong>. Give user permission to read and write in any topic:</p>
<p><a href="wp-content\uploads\MQTT-example-cloud5.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud5.jpg" width="401" height="154"></a></p>
<p>Next set the instance of the mqtt <strong>driver.0</strong> to connect as a client/subscriber cloud broker and a list of publications/subscriptions:</p>
<p><a href="wp-content\uploads\8.png"><img class="alignnone size-medium wp-image-6614" src="wp-content\uploads\8-283x300.png" alt="" width="283" height="300" srcset="wp-content\uploads\8-283x300.png 283w, wp-content\uploads\8-141x150.png 141w, wp-content\uploads\8-100x106.png 100w, wp-content\uploads\8-150x159.png 150w, wp-content\uploads\8-200x212.png 200w, wp-content\uploads\8-300x318.png 300w, wp-content\uploads\8-450x478.png 450w, wp-content\uploads\8-600x637.png 600w, wp-content\uploads\8.png 797w" sizes="(max-width: 283px) 100vw, 283px"></a></p>
<ul>
<li>connection type – the customer/subscriber,</li>
<li>connection settings – specify the URL issued in the control panel <a href="https://www.cloudmqtt.com/">cloudmqtt.com</a> the port will use <strong>22809</strong>that works with <strong>SSL</strong>,</li>
<li>in the authentication options specify the user name and password,</li>
<li>patterns – our client ioBroker will be signed on all the topics that are in the cloud, so you specify here the number sign (<strong>#</strong>), you can use a mask to selectively subscribe,</li>
<li>mask of the eigenvalues client will publish to the server <strong>temperature/humidity</strong> and the status of all ports megaD (ports with relay P7-P13),this field separated by a comma specify the required variables:<br>
<strong>mqtt.1.example2.hum,mqtt.1.example2.temp,megad.0.p7_P7,megad.0.p8_P8,megad.0.p9_P9,megad.0.p10_P10,megad.0.p11_P11,megad.0.p12_P12,megad.0.p13_P13</strong>,</li>
<li>to send only changes – put a tick, will publish only the changes,</li>
<li>to give your own values at the start – just specify to create topics,</li>
<li>to send not only commands, but also the state (ack=true) – it should be noted that setting both the temperature/humidity updated driver mqtt (ack=true).</li>
</ul>
<p>Settings saved, make sure that the connection is established (on the control panel <a href="https://www.cloudmqtt.com/">cloudmqtt.com</a> watch the log server). After some time, data will appear (in the panel link <strong>WebsocketUI</strong>):</p>
<p><a href="wp-content\uploads\MQTT-example-cloud7.jpg"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud7.jpg" width="400" height="377"></a></p>
<p>In the end, it remains only to configure a mobile client, for example <a href="https://play.google.com/store/apps/details?id=com.thn.iotmqttdashboard&hl=en">IoT MQTT Dashboard</a>. Create a new connection:</p>
<p><a href="wp-content\uploads\MQTT-example-cloud8.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud8.png" width="302" height="515"></a></p>
<p>Create topics for publication (for example, lighting of the hall &#8211; port <strong>P7</strong> MegaD):</p>
<p><a href="wp-content\uploads\MQTT-example-cloud9.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud9.png" width="300" height="512"></a></p>
<p>Создаем топики подписок (температура, влажность, освещение зала порт <strong>P7</strong> MegaD):</p>
<p><a href="wp-content\uploads\MQTT-example-cloud10.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud10.png" width="250" height="427"> </a><a href="wp-content\uploads\MQTT-example-cloud11.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud11.png" width="250" height="427"> </a><a href="wp-content\uploads\MQTT-example-cloud12.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud12.png" width="250" height="427"></a></p>
<p>In the end, your dashboard might look something like this:</p>
<p><a href="wp-content\uploads\MQTT-example-cloud13.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud13.png" width="250" height="427"> </a><a href="wp-content\uploads\MQTT-example-cloud14.png"><img class="alignnone" src="wp-content\uploads\MQTT-example-cloud14.png" width="250" height="427"></a></p>
<p>After the creation of the publications on a mobile device, in the driver instance <strong>mqtt.0</strong> system ioBroker should appear variable light control that should be used in the script for lighting control (see <a href="index-88.htm?page_id=6435&amp;lang=en#Application_8211_connecting_mobile_clients">example above</a>):</p>
<p><a href="wp-content\uploads\mqtt_13.png"><img class="alignnone size-large wp-image-6615" src="wp-content\uploads\mqtt_13-1024x230.png" alt="" width="750" height="168" srcset="wp-content\uploads\mqtt_13-1024x230.png 1024w, wp-content\uploads\mqtt_13-150x34.png 150w, wp-content\uploads\mqtt_13-300x67.png 300w, wp-content\uploads\mqtt_13-100x22.png 100w, wp-content\uploads\mqtt_13-200x45.png 200w, wp-content\uploads\mqtt_13-450x101.png 450w, wp-content\uploads\mqtt_13-600x135.png 600w, wp-content\uploads\mqtt_13-900x202.png 900w" sizes="(max-width: 750px) 100vw, 750px"></a></p>
<p>Congratulations! Now you can control the system ioBroker and receive data via a cloud service!</p>
				
<footer class="post-data">
	
	<div class="entry-meta">
			</div><!-- .entry-meta -->
	</footer><!-- .post-data -->
			</div><!-- .post-entry -->
	</article><!-- #post-## -->

				
			
		</main><!-- #main -->

			<div id="widgets" class="widget-area right-sidebar" role="complementary" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
		
		<div id="text-11" class="widget-wrapper widget_text">			<div class="textwidget"><div class="adaptermenueclass">
<!-- Page-list plugin v.5.1 wordpress.org/plugins/page-list/ -->
<ul class="page-list ">
<li class="page_item page-item-2412 page_item_has_children"><a href="index-36.htm?page_id=2412&lang=de">Adapter Kategorie VIS</a>
<ul class='children'>
	<li class="page_item page-item-6846"><a href="index-290.htm?page_id=6846&lang=de">Adapter_vis_widgets</a></li>
	<li class="page_item page-item-3467"><a href="index-297.htm?page_id=3467&lang=de">Icons addictive flavour png</a></li>
	<li class="page_item page-item-3565"><a href="index-292.htm?page_id=3565&lang=de">Icons material png</a></li>
	<li class="page_item page-item-3569"><a href="index-293.htm?page_id=3569&lang=de">Icons material svg</a></li>
	<li class="page_item page-item-3573"><a href="index-295.htm?page_id=3573&lang=de">Icons mfd png</a></li>
	<li class="page_item page-item-3571"><a href="index-294.htm?page_id=3571&lang=de">Icons mfd svg</a></li>
	<li class="page_item page-item-3606"><a href="index-291.htm?page_id=3606&lang=de">Icons open icon library png</a></li>
	<li class="page_item page-item-3607"><a href="index-289.htm?page_id=3607&lang=de">Icons ultimate png</a></li>
	<li class="page_item page-item-2754"><a href="index-194.htm?page_id=2754&lang=de">ioBroker Visualisation</a></li>
	<li class="page_item page-item-5026"><a href="index-37.htm?page_id=5026&lang=de">ioBroker.vis App</a></li>
	<li class="page_item page-item-2765"><a href="index-296.htm?page_id=2765&lang=de">vis-timeandweather</a></li>
	<li class="page_item page-item-1048"><a href="index-288.htm?page_id=1048&lang=de">Widgets Grundfunktionen</a></li>
</ul>
</li>
<li class="page_item page-item-2238 page_item_has_children"><a href="index-29.htm?page_id=2238&lang=de">Allgemein</a>
<ul class='children'>
	<li class="page_item page-item-5473 page_item_has_children"><a href="index-241.htm?page_id=5473&lang=de">Adapter Admin</a>
	<ul class='children'>
		<li class="page_item page-item-5379"><a href="index-235.htm?page_id=5379&lang=de">Admin &#8211; Reiter Adapter</a></li>
		<li class="page_item page-item-5755"><a href="index-248.htm?page_id=5755&lang=de">Admin &#8211; Reiter Aufzählungen</a></li>
		<li class="page_item page-item-5746"><a href="index-246.htm?page_id=5746&lang=de">Admin &#8211; Reiter Benutzer</a></li>
		<li class="page_item page-item-5579"><a href="index-245.htm?page_id=5579&lang=de">Admin &#8211; Reiter Ereignisse</a></li>
		<li class="page_item page-item-5549"><a href="index-247.htm?page_id=5549&lang=de">Admin &#8211; Reiter Gruppen</a></li>
		<li class="page_item page-item-5590"><a href="index-249.htm?page_id=5590&lang=de">Admin &#8211; Reiter Hosts</a></li>
		<li class="page_item page-item-5474"><a href="index-242.htm?page_id=5474&lang=de">Admin &#8211; Reiter Instanzen</a></li>
		<li class="page_item page-item-5604"><a href="index-250.htm?page_id=5604&lang=de">Admin &#8211; Reiter Log</a></li>
		<li class="page_item page-item-5495"><a href="index-243.htm?page_id=5495&lang=de">Admin &#8211; Reiter Objekte</a></li>
		<li class="page_item page-item-5526"><a href="index-244.htm?page_id=5526&lang=de">Admin &#8211; Reiter Zustände</a></li>
		<li class="page_item page-item-6227"><a href="index-234.htm?page_id=6227&lang=de">Admin &#8211; Systemeinstellungen</a></li>
	</ul>
</li>
	<li class="page_item page-item-3362"><a href="index-251.htm?page_id=3362&lang=de">Adapter HomeKit</a></li>
	<li class="page_item page-item-4654"><a href="index-252.htm?page_id=4654&lang=de">Adapter Tankerkönig / Spritpreis</a></li>
</ul>
</li>
<li class="page_item page-item-2407 page_item_has_children"><a href="index-30.htm?page_id=2407&lang=de">Aufbewahrung</a>
<ul class='children'>
	<li class="page_item page-item-144"><a href="index-191.htm?page_id=144&lang=de">Adapter History</a></li>
	<li class="page_item page-item-3608"><a href="index-253.htm?page_id=3608&lang=de">Adapter InfluxDB</a></li>
	<li class="page_item page-item-3772"><a href="index-254.htm?page_id=3772&lang=de">Adapter SQL</a></li>
</ul>
</li>
<li class="page_item page-item-2405 page_item_has_children"><a href="index-32.htm?page_id=2405&lang=de">Hardware</a>
<ul class='children'>
	<li class="page_item page-item-2818"><a href="index-267.htm?page_id=2818&lang=de">ArtNet</a></li>
	<li class="page_item page-item-115"><a href="index-261.htm?page_id=115&lang=de">B-Control Energy Manager</a></li>
	<li class="page_item page-item-969"><a href="index-265.htm?page_id=969&lang=de">CUL</a></li>
	<li class="page_item page-item-2847"><a href="index-260.htm?page_id=2847&lang=de">Fritzbox</a></li>
	<li class="page_item page-item-2825"><a href="index-193.htm?page_id=2825&lang=de">HomeMatic ReGaHSS</a></li>
	<li class="page_item page-item-2829"><a href="index-192.htm?page_id=2829&lang=de">HomeMatic RPC</a></li>
	<li class="page_item page-item-150"><a href="index-262.htm?page_id=150&lang=de">Homematic-Manager (hmm)</a></li>
	<li class="page_item page-item-4933"><a href="index-259.htm?page_id=4933&lang=de">Homepilot</a></li>
	<li class="page_item page-item-158"><a href="index-264.htm?page_id=158&lang=de">KNX</a></li>
	<li class="page_item page-item-2007"><a href="index-266.htm?page_id=2007&lang=de">Logitech Harmony</a></li>
	<li class="page_item page-item-3781"><a href="index-256.htm?page_id=3781&lang=de">MegaD-328 (deutsch)</a></li>
	<li class="page_item page-item-3784"><a href="index-257.htm?page_id=3784&lang=de">Miele</a></li>
	<li class="page_item page-item-3788"><a href="index-258.htm?page_id=3788&lang=de">Modbus</a></li>
	<li class="page_item page-item-152"><a href="index-263.htm?page_id=152&lang=de">Philips Hue</a></li>
	<li class="page_item page-item-5416"><a href="index-269.htm?page_id=5416&lang=de">RFLink</a></li>
	<li class="page_item page-item-6876"><a href="index-255.htm?page_id=6876&lang=de">Siemens SIMATIC S7</a></li>
	<li class="page_item page-item-4250"><a href="index-268.htm?page_id=4250&lang=de">Wolf</a></li>
</ul>
</li>
<li class="page_item page-item-2417 page_item_has_children"><a href="index-33.htm?page_id=2417&lang=de">Kommunikation</a>
<ul class='children'>
	<li class="page_item page-item-172"><a href="index-271.htm?page_id=172&lang=de">Adapter Ping</a></li>
	<li class="page_item page-item-174"><a href="index-273.htm?page_id=174&lang=de">Adapter Pushover</a></li>
	<li class="page_item page-item-5285"><a href="index-272.htm?page_id=5285&lang=de">Adapter Pushsafer</a></li>
	<li class="page_item page-item-180"><a href="index-274.htm?page_id=180&lang=de">Adapter socketio</a></li>
	<li class="page_item page-item-5945"><a href="index-275.htm?page_id=5945&lang=de">Adapter Web</a></li>
	<li class="page_item page-item-134"><a href="index-270.htm?page_id=134&lang=de">eMail</a></li>
</ul>
</li>
<li class="page_item page-item-2419 page_item_has_children"><a href="index-34.htm?page_id=2419&lang=de">Medien</a>
<ul class='children'>
	<li class="page_item page-item-182"><a href="index-277.htm?page_id=182&lang=de">Adapter SONOS</a></li>
	<li class="page_item page-item-3026"><a href="index-278.htm?page_id=3026&lang=de">chromecast</a></li>
	<li class="page_item page-item-178"><a href="index-276.htm?page_id=178&lang=de">Sayit</a></li>
</ul>
</li>
<li class="page_item page-item-2415 page_item_has_children"><a href="index-35.htm?page_id=2415&lang=de">Skripte und Logik</a>
<ul class='children'>
	<li class="page_item page-item-6818"><a href="index-282.htm?page_id=6818&lang=de">Javascript Engine</a></li>
	<li class="page_item page-item-5319"><a href="index-279.htm?page_id=5319&lang=de">Javascript Script mit Blockly</a></li>
	<li class="page_item page-item-4284"><a href="index-280.htm?page_id=4284&lang=de">node-red</a></li>
	<li class="page_item page-item-1950"><a href="index-281.htm?page_id=1950&lang=de">Szenen-Adapter</a></li>
</ul>
</li>
<li class="page_item page-item-2403 page_item_has_children"><a href="index-38.htm?page_id=2403&lang=de">Visualisierung</a>
<ul class='children'>
	<li class="page_item page-item-198"><a href="index-195.htm?page_id=198&lang=de">Adapter Flot</a></li>
	<li class="page_item page-item-3786"><a href="index-284.htm?page_id=3786&lang=de">Adapter Mobile</a></li>
</ul>
</li>
<li class="page_item page-item-2421 page_item_has_children"><a href="index-39.htm?page_id=2421&lang=de">Wartung</a>
<ul class='children'>
	<li class="page_item page-item-3349"><a href="index-283.htm?page_id=3349&lang=de">Adapter Geofency</a></li>
</ul>
</li>
<li class="page_item page-item-2401 page_item_has_children"><a href="index-40.htm?page_id=2401&lang=de">Wetter</a>
<ul class='children'>
	<li class="page_item page-item-4690"><a href="index-287.htm?page_id=4690&lang=de">Adapter Solarwetter</a></li>
	<li class="page_item page-item-2760"><a href="index-286.htm?page_id=2760&lang=de">DWD (Deutscher Wetter Dienst)</a></li>
	<li class="page_item page-item-194"><a href="index-285.htm?page_id=194&lang=de">yr</a></li>
</ul>
</li>
<li class="page_item page-item-2410 page_item_has_children"><a href="index-41.htm?page_id=2410&lang=de">Zeitplanung</a>
<ul class='children'>
	<li class="page_item page-item-3822"><a href="index-299.htm?page_id=3822&lang=de">Feiertage</a></li>
	<li class="page_item page-item-154"><a href="index-298.htm?page_id=154&lang=de">iCal</a></li>
	<li class="page_item page-item-3833"><a href="index-300.htm?page_id=3833&lang=de">tvspielfilm</a></li>
</ul>
</li>

</ul></div></div>
		</div>
			</div><!-- end of #widgets -->
	</div><!-- #content -->

</div><!-- end of #wrapper -->
</div><!-- end of #container -->


<footer id="footer" class="site-footer" role="contentinfo" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
		<div id="footer-wrapper">

		<div id="footer-widgets-container">
					</div><!-- #footer-widgets-container-->

		<div id="menu-social-container">
			<nav id="footer-menu-container">
				<ul id="menu-2016_seitenfuss_de" class="footer-menu"><li id="menu-item-2210" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2210"><a href="index-61.htm?page_id=2208&#038;lang=de">Kontakt</a></li>
<li id="menu-item-2227" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2227"><a href="index-62.htm?page_id=2223&#038;lang=de">Impressum</a></li>
<li id="menu-item-2307" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2307"><a href="index-63.htm?page_id=2305&#038;lang=de">Datenschutzerklärung</a></li>
<li id="menu-item-2314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2314"><a href="index-64.htm?page_id=2303&#038;lang=de">Sitemap</a></li>
<li id="menu-item-2486" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2486"><a href="index-65.htm?page_id=2484&#038;lang=de">Danke</a></li>
</ul>			</nav><!-- #footer-menu -->
			<div id="social-icons-container">
				<ul class="social-icons"></ul><!-- .social-icons -->			</div><!-- #social-icons-container-->
		</div><!-- #menu-social-container -->

		
		<div id="footer-base">
			<div class="copyright">
				&copy; 2019 <a href="index.htm?lang=de" title="ioBroker">ioBroker</a>			</div><!-- .copyright -->

			<div class="powered">
				<a href="http://cyberchimps.com/responsive-II/">Reaktionsschnelle II</a> angetrieben <a href="http://wordpress.org/">WordPress</a>			</div><!-- end .powered -->

			<div class="scroll-top">
				<a href="#scroll-top" title="Nach oben scrollen">↑</a>
			</div><!-- .scroll-top -->
		</div><!-- #footer-base -->
	</div><!-- #footer-wrapper -->
	</footer><!-- #footer -->
<div id="cookie-law-info-bar"><span>This website uses cookies to improve your experience. We'll assume you're ok with this, but you can opt-out if you wish.<a data-cli_action="accept" id="cookie_action_close_header" class="medium cli-plugin-button cli-plugin-main-button cookie_action_close_header cli_action_button" style="display:inline-block; ">Akzeptieren</a> <a href='..\index-1.htm?page_id=2305&#038;lang=de' id="CONSTANT_OPEN_URL" target="_blank" class="cli-plugin-main-link" style="display:inline-block;">mehr Infos</a></span></div><div id="cookie-law-info-again" style="display:none;"><span id="cookie_hdr_showagain">Privacy & Cookies Policy</span></div><div class="cli-modal-backdrop cli-fade cli-settings-overlay"></div>
<div class="cli-modal-backdrop cli-fade cli-popupbar-overlay"></div>
<script type="text/javascript">
  /* <![CDATA[ */
  cli_cookiebar_settings='{"animate_speed_hide":"500","animate_speed_show":"500","background":"#fff","border":"#444","border_on":false,"button_1_button_colour":"#000","button_1_button_hover":"#000000","button_1_link_colour":"#fff","button_1_as_button":true,"button_1_new_win":false,"button_2_button_colour":"#333","button_2_button_hover":"#292929","button_2_link_colour":"#444","button_2_as_button":false,"button_2_hidebar":true,"button_3_button_colour":"#000","button_3_button_hover":"#000000","button_3_link_colour":"#fff","button_3_as_button":true,"button_3_new_win":false,"button_4_button_colour":"#000","button_4_button_hover":"#000000","button_4_link_colour":"#fff","button_4_as_button":true,"font_family":"inherit","header_fix":false,"notify_animate_hide":true,"notify_animate_show":false,"notify_div_id":"#cookie-law-info-bar","notify_position_horizontal":"right","notify_position_vertical":"bottom","scroll_close":false,"scroll_close_reload":false,"accept_close_reload":false,"reject_close_reload":false,"showagain_tab":false,"showagain_background":"#fff","showagain_border":"#000","showagain_div_id":"#cookie-law-info-again","showagain_x_position":"100px","text":"#000","show_once_yn":false,"show_once":"10000","logging_on":false,"as_popup":false,"popup_overlay":true,"bar_heading_text":"","cookie_bar_as":"banner","popup_showagain_position":"bottom-right","widget_position":"left"}';
  /* ]]> */
</script><div class="scroll-back-to-top-wrapper">
	<span class="scroll-back-to-top-inner">
					<i class="fa fa-2x fa-arrow-circle-up"></i>
			</span>
</div><script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/www.iobroker.net\/docu\/?rest_route=\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Bitte best\u00e4tige, dass du keine Maschine bist."}}};
var wpcf7 = {"apiSettings":{"root":"http:\/\/www.iobroker.net\/docu\/?rest_route=\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Bitte best\u00e4tige, dass du keine Maschine bist."}}};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content\plugins\contact-form-7\includes\js\scripts.js?ver=4.9.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var scrollBackToTop = {"scrollDuration":"500","fadeDuration":"0.5"};
var scrollBackToTop = {"scrollDuration":"500","fadeDuration":"0.5"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content\plugins\scroll-back-to-top\assets\js\scroll-back-to-top.js'></script>
<script type='text/javascript' src='wp-content\plugins\table-of-contents-plus\front.min.js?ver=1509'></script>
<script type='text/javascript' src='wp-content\themes\responsive-mobile\js\responsive-scripts.min.js?ver=1.2.5'></script>
<script type='text/javascript' src='wp-includes\js\wp-embed.min.js?ver=4.7.5'></script>
</body>
</html>
